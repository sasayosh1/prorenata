name: Daily X Auto Post

on:
  schedule:
    # æ¯æ—¥PM8:30é ƒ (JST) = PM11:30 (UTC) ã«èµ·å‹•
    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§0ã€œ60åˆ†ã®ãƒ©ãƒ³ãƒ€ãƒ å¾…æ©Ÿå¾Œã«æŠ•ç¨¿ï¼ˆå®Ÿè³ªPM8:30ã€œ9:30ã®é–“ï¼‰
    - cron: '30 11 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½ã«ã™ã‚‹

jobs:
  post_to_x:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run X auto-post script
        run: node scripts/auto-post-to-x.js
        env:
          SANITY_API_TOKEN: ${{ secrets.SANITY_API_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}

      - name: Post summary
        if: always()
        run: |
          echo "âœ… Xè‡ªå‹•æŠ•ç¨¿å‡¦ç†å®Œäº†"
          echo "ğŸ“Š å®Ÿè¡Œæ™‚åˆ»: $(TZ=Asia/Tokyo date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M')"
