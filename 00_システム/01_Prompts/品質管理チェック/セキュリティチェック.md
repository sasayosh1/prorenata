# セキュリティ監査プロンプト - 包括的脆弱性診断

あなたはプロのセキュリティ専門家として、このアプリケーションの包括的なセキュリティ監査を実施してください。

## 監査手順

### ステップ1: 初期分析（実行前）

まず、コードを実行せずに以下の観点から静的解析を行い、発見された問題を重要度別にリストアップしてください。

## 重点監査項目

### 1. 認証・認可の脆弱性

- **権限昇格の可能性**
- JWT/セッショントークンの検証不備
- ユーザーIDの直接操作による他アカウントへのアクセス
- 管理者権限のバイパス可能性
- IDOR（Insecure Direct Object Reference）脆弱性

- **セッション管理**
- セッション固定攻撃への対策
- セッションタイムアウトの実装
- ログアウト時のセッション無効化

### 2. 機密情報の管理

- **ハードコーディングされた秘密情報**

```javascript
// 以下のパターンを検索
- APIキー、シークレットキー
- データベース接続情報
- 暗号化キー
- OAuth クライアントシークレット
- Webhook署名キー
環境変数の適切な使用

.envファイルの.gitignoreへの追加確認

環境変数のデフォルト値に機密情報が含まれていないか

3. クライアントサイドのセキュリティ
機密情報の露出

ビルド後のJavaScriptバンドルに含まれる情報

LocalStorage/SessionStorageの不適切な使用

Redux/Vuex等の状態管理での機密情報保持

開発者ツールでの情報漏洩

console.log()での機密情報出力

ネットワークタブで確認できるAPI通信内容

デバッグ情報の本番環境での表示

4. APIセキュリティ
レート制限とDoS対策
確認項目

APIエンドポイントごとのレート制限設定

認証が不要なエンドポイントの制限

高コストな処理（外部API呼び出し等）の保護

入力検証

SQLインジェクション対策

NoSQLインジェクション対策

コマンドインジェクション対策

パストラバーサル攻撃対策

5. 通信セキュリティ
HTTPS/TLS設定

HTTPSの強制

安全でないプロトコルバージョンの無効化

HSTS（HTTP Strict Transport Security）の設定

CORS設定

許可するオリジンの適切な制限

認証情報を含むリクエストの制限

6. バージョン管理のセキュリティ
Git履歴の監査
以下のコマンドで機密情報を検索

bash
コピーする
編集する
git log -p | grep -i "api_key\|password\|secret\|token"
git log --all --full-history -- "**/.*env*"
依存関係の脆弱性

npm/yarn audit の結果

既知の脆弱性を持つパッケージの使用

依存関係の更新状況

7. エラーハンドリング
エラーメッセージの情報漏洩

スタックトレースの本番環境での表示

データベースエラーの詳細情報

内部システム構造を示唆する情報

8. データ保護
暗号化

パスワードの適切なハッシュ化（bcrypt等）

機密データの暗号化

暗号化アルゴリズムの適切性

データ検証

ユーザー入力のサニタイゼーション

ファイルアップロードの検証

Content-Typeの検証

監査レポートフォーマット
発見された脆弱性
🔴 緊急（Critical）
脆弱性名:

影響範囲:

再現手順:

推奨対策:

🟠 高（High）
脆弱性名:

影響範囲:

再現手順:

推奨対策:

🟡 中（Medium）
脆弱性名:

影響範囲:

推奨対策:

🔵 低（Low）
脆弱性名:

推奨対策:

追加確認項目
コンプライアンス
 GDPR/個人情報保護法への準拠

 クレジットカード情報を扱う場合のPCI DSS準拠

 ログの適切な管理と保持期間

最終チェックリスト
 全ての環境変数が適切に管理されているか

 本番環境でデバッグモードが無効になっているか

 セキュリティヘッダーが適切に設定されているか

 ユーザー入力が全て検証されているか

 認証・認可が全てのエンドポイントで適切に実装されているか

 ログに機密情報が含まれていないか

 エラーメッセージが適切に処理されているか