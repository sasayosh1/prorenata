#!/usr/bin/env node
require('dotenv').config({ path: require('path').resolve(__dirname, '../.env.local') })
const { createClient } = require('@sanity/client')
const { createMoshimoLinkBlocks } = require('./moshimo-affiliate-links')
const crypto = require('crypto')

const client = createClient({
  projectId: '72m8vhy2',
  dataset: 'production',
  apiVersion: '2024-01-01',
  token: process.env.SANITY_WRITE_TOKEN,
  useCdn: false,
})

function block(text, { style = 'normal', listItem, level } = {}) {
  return {
    _type: 'block',
    _key: crypto.randomUUID(),
    style,
    listItem,
    level,
    markDefs: [],
    children: [
      {
        _type: 'span',
        _key: crypto.randomUUID(),
        marks: [],
        text,
      },
    ],
  }
}

function bullet(text) {
  return block(text, { style: 'normal', listItem: 'bullet', level: 1 })
}

function heading(value) {
  return block(value, { style: 'h2' })
}

function heading3(value) {
  return block(value, { style: 'h3' })
}

function ctaWithEmbed(key, ctaText, context) {
  return createMoshimoLinkBlocks(key, context, { ctaText }) || []
}

async function main() {
  const slug = 'nursing-assistant-compare-services-perspective'
  const doc = await client.fetch('*[_type == "post" && slug.current == $slug][0]{ _id }', { slug })
  if (!doc?._id) {
    console.error('対象記事が見つかりません')
    process.exit(1)
  }

  const body = []
  body.push(
    block('看護助手として転職を考えるとき、求人票だけでは分からないサポート範囲や担当者の動き方が気になります。'),
    block('この記事では、現場でよく耳にする３つの相談先を「看護助手の悩み」にフォーカスして比較し、どんな人に向いているかを整理しました。')
  )

  body.push(heading('１．サービスの特徴をざっくり比較'))
  body.push(
    block('最初に全体像を押さえましょう。どのサービスも無料で相談できますが、得意領域や担当者のスタイルが異なるため、優先したいことを明確にしておくと相性の良い窓口が見つかります。')
  )
  body.push(
    bullet('全国求人を横断的に確認したいときは、教育制度や福利厚生の細部まで調べてくれる窓口を選ぶこと。'),
    bullet('関西圏・都市部で条件交渉を任せたいときは、夜勤回数や残業時間の交渉実績がある担当者が心強い。'),
    bullet('無資格・未経験から挑戦する場合は、資格取得支援や派遣で経験を積む仕組みがあるサービスが安心。')
  )

  // ヒューマンライフケア詳細
  body.push(heading3('ヒューマンライフケア｜全国の病院・老健とつながる王道ルート'))
  body.push(
    block('医療法人や老健と長年取引しており、面接前に教育制度・福利厚生・夜勤体制の細部まで確認してくれます。地方から都市部への移動、家庭の事情による時短勤務など、事情を汲んで提案してくれるのが強みです。'),
    bullet('病棟の教育担当者に直接ヒアリングし、研修スケジュールを事前に共有してくれる'),
    bullet('配属後のフォローが手厚く、ミスマッチを感じた場合も早めに調整してくれる'),
    bullet('デイサービスや老健など医療以外の選択肢も視野に入れて提案してくれる')
  )
  body.push(...ctaWithEmbed('humanlifecare', '教育制度まで丁寧に確認してほしいときは、ヒューマンライフケアに希望条件を預けてみてください。 ヒューマンライフケアの求人サポートを見る', 'ヒューマンライフケアの特徴'))

  // リニューケア詳細
  body.push(heading3('リニューケア｜関西圏・都市部の条件交渉に強いパートナー'))
  body.push(
    block('大阪・京都・神戸など都市部の医療法人と密に連携し、夜勤回数や給与レンジの交渉を得意とするサービスです。LINEでのやり取りが中心なので、夜勤前後の限られた時間でも相談しやすいのが魅力です。'),
    bullet('夜勤月何回まで、残業はどの程度かといった細かな条件交渉を代行'),
    bullet('都市部の非公開求人に強く、病院ごとの雰囲気や師長の人柄まで共有してくれる'),
    bullet('深夜帯でもLINE返信があり、シフト制の生活リズムでも連絡が途切れない')
  )
  body.push(...ctaWithEmbed('renewcare', '関西圏や都市部で交渉を任せたいなら、リニューケアに希望の夜勤回数や給与レンジを整理して伝えると調整がスムーズです。 リニューケアの転職支援に相談する', 'リニューケアの特徴'))

  // かいご畑詳細
  body.push(heading3('かいご畑｜無資格・未経験から資格取得まで伴走'))
  body.push(
    block('派遣・紹介予定派遣を組み合わせ、経験を積みながら資格取得を目指せるのがかいご畑です。実務者研修の受講費用を一部負担する制度があり、「まず現場に慣れてから正社員を目指したい」という人から支持されています。'),
    bullet('派遣で週３日からスタートし、慣れてきたら正社員求人を紹介してくれる'),
    bullet('実務者研修や介護福祉士受験に向けた学習サポートがある'),
    bullet('子育てや介護と両立するためのシフト調整を一緒に考えてくれる')
  )
  body.push(...ctaWithEmbed('kaigobatake', '無資格・未経験からじっくり準備したい場合は、かいご畑の資格支援付き求人をチェックしてみてください。 かいご畑で介護職・看護助手の求人を探す', 'かいご畑の特徴'))

  body.push(heading('２．料金と契約のしくみ'))
  body.push(
    block('３社とも登録者から費用を取らず、病院や施設側が紹介料を支払う完全無料型です。面談・求人紹介・書類添削・面接日程の調整までまとめて任せられるので、「紹介料を払っている病院の希望だけ押し付けられるのでは？」と心配な場合も、率直に条件を伝えて問題ありません。'),
    block('ただし、契約形態や更新時期のフォローには違いがあります。自分の生活リズムにあった契約タイプを選べるよう、各サービスの特徴を把握しておきましょう。')
  )
  body.push(heading3('費用負担と契約タイプを比較'))
  body.push(
    block('ヒューマンライフケアは正社員・契約社員の紹介が中心で、内定後に提示される労働条件書を一緒に確認してくれます。賞与や住宅手当の有無など、書面で見落としがちな部分も丁寧にチェックしてくれるので、年収シミュレーションまで安心して任せられます。'),
    block('リニューケアは都市部の医療法人と交渉実績が多く、夜勤手当や残業代の発生条件など数字の部分に強いのが特徴です。LINEで条件交渉の進捗を共有してくれるため、「あと一歩基本給を上げたい」「夜勤を月６回に抑えたい」といった希望を現実的なラインに落とし込んでくれます。'),
    block('かいご畑は派遣・紹介予定派遣の案件を多く扱い、契約期間ごとに面談が入ります。更新前にはシフトや体調をヒアリングし、無理のない労働時間を一緒に考えてくれます。派遣で働きながら資格取得を進め、タイミングを見て正社員紹介へ切り替える利用者も多いです。')
  )

  body.push(heading('３．登録から入職までの流れ'))
  body.push(
    block('各社とも大きな流れは共通しています。事前に準備しておくと、面談がスムーズです。'),
    block('1. WebフォームやLINEで登録 → 面談日程を調整。勤務中なら夜勤明けの時間帯も相談可能。'),
    block('2. 担当者ヒアリング → 希望業務、通勤時間、残業の限度、夜勤回数など優先順位を整理。'),
    block('3. 求人紹介・面接調整 → 条件に合う求人を提案し、応募先と日程を組む。'),
    block('4. 面接対策と条件確認 → 面接前に想定質問や確認事項を共有し、内定後は書面の条件を一緒にチェック。'),
    block('5. 入職準備 → ロッカーや制服、勤務開始日の詳細を確認し、必要書類を提出。')
  )
  body.push(block('この流れを踏むことで、担当者は「譲れない条件」と「妥協してもよい条件」を把握してくれます。とくに看護助手は夜勤や介助業務が多い仕事なので、体力面の不安や家族のサポート事情なども遠慮なく共有しておくと、配属先のミスマッチを防げます。'))

  body.push(heading('４．サポート体制で見る３つの違い'))
  body.push(block('担当者の関わり方は、転職活動のストレスを減らすうえでとても大切です。それぞれのサポートスタイルを事前に知っておくと、相談の切り出し方が変わり、希望が通りやすくなります。'))
  body.push(heading3('ヒューマンライフケアのフォロー'))
  body.push(block('日中の電話・メール対応が得意で、病棟の教育担当者や人事と直接やり取りしてくれます。面接同行の際は「この病棟ではこんなアピールが好印象」といったポイントまで共有してくれるので、初めての転職でも安心して臨めます。'))
  body.push(heading3('リニューケアのフォロー'))
  body.push(block('夜勤前後でもLINEで気軽に相談でき、数字の交渉に強いのが特徴です。給与・夜勤回数・残業時間など、こちらが言いづらい条件もテキストで伝えられるため、生活リズムを崩さずに交渉を進められます。'))
  body.push(heading3('かいご畑のフォロー'))
  body.push(block('派遣で経験を積みながら資格取得を目指す場合、勉強時間の確保が課題になります。かいご畑は研修日程を考慮したシフト案を一緒に組んでくれるので、無理なくスキルアップを続けられます。'))

  body.push(heading('５．それぞれが向いている人'))
  body.push(
    block('ヒューマンライフケアは「教育体制が整った病棟でリスタートしたい」「転居したばかりで土地勘がない」といった人に向いています。全国の求人を比較しながら提案してくれるので、複数の地域を検討している人にもおすすめです。'),
    block('リニューケアは「今より夜勤回数を減らしたい」「基本給を上げたい」など交渉テーマが明確な人と相性が良いです。関西圏・都市部の情報に強いので、都市型病院でキャリアアップしたい人は相談してみる価値があります。'),
    block('かいご畑は「まずは週３日の派遣から始めたい」「資格取得の費用を抑えたい」という人にぴったり。子育てや家族の介護と両立しながら経験を積みたい場合も、柔軟なシフトを一緒に考えてくれます。')
  )

  body.push(heading('６．利用者の声とよくある質問'))
  body.push(
    bullet('「ヒューマンライフケアは面接同行が丁寧で、緊張しがちな自分でも話しやすかった」'),
    bullet('「リニューケアは深夜でもLINEで相談でき、夜勤型の生活リズムでもやり取りしやすかった」'),
    bullet('「かいご畑の派遣で半年働きながら実務者研修を受け、希望の病院に転職できた」')
  )
  body.push(
    block('Q. 複数サービスに登録しても失礼ではありませんか？ → むしろ比較することで相性の良い担当者が見つかります。どのサービスも併用を前提にしているので、遠慮なく相談しましょう。'),
    block('Q. すぐ辞めたくなった場合は？ → 派遣契約なら更新前に担当へ相談、正社員の場合も再度求人を探してもらえます。退職理由を一人で抱え込む前に共有するのが得策です。'),
    block('Q. 家族に相談しづらいのですが？ → 担当者にそのまま伝えれば、家族へ説明する時の資料や話し方までアドバイスしてくれます。')
  )

  body.push(heading('７．まとめと次のステップ'))
  body.push(
    block('看護助手の転職は、求人の数だけでなく担当者のサポート領域で成果が変わります。全国の情報を網羅したいならヒューマンライフケア、条件交渉を細かく進めたいならリニューケア、未経験から準備したいならかいご畑といったように、自分の優先順位に合わせて相談先を使い分けてください。'),
    block('希望条件をメモしたチェックリストを作っておくと、各サービスの面談で聞き忘れがなくなります。気になる施設があれば、通勤時間や夜勤の入り方まで具体的に質問して比較しましょう。'),
    block('３社とも無料で利用できるので、まずは連絡が取りやすい時間帯と希望条件を整理し、できるだけ早く情報を集めるのが成功の近道です。')
  )
  body.push(...ctaWithEmbed('humanlifecare', '全国の医療法人や老健を幅広く比較したい方は、ヒューマンライフケアの担当者に教育体制や福利厚生の条件をまとめて確認してもらいましょう。 ヒューマンライフケアの求人サポートを見る', 'まとめ後CTA'))
  body.push(...ctaWithEmbed('renewcare', '夜勤回数や給与交渉をしっかり進めたい方は、リニューケアに希望条件を整理して共有してください。 リニューケアの転職支援に相談する', 'まとめ後CTA'))
  body.push(...ctaWithEmbed('kaigobatake', '無資格・未経験からキャリアを積みたい方は、かいご畑で資格支援付き求人をチェックしてみてください。 かいご畑で介護職・看護助手の求人を探す', 'まとめ後CTA'))

  await client.patch(doc._id).set({ body }).commit()
  console.log('✅ 記事本文を更新しました')
}

main().catch(err => {
  console.error(err)
  process.exit(1)
})
