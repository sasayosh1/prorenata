const fs = require('fs');
const path = require('path');
const { GoogleGenerativeAI } = require('@google/generative-ai');

// --- Configuration ---
const GEMINI_API_KEY = process.env.GEMINI_API_KEY?.trim();
if (!GEMINI_API_KEY) {
    console.error("FATAL: GEMINI_API_KEY is not set.");
    process.exit(1);
}

const LIFESTYLE_FILE_PATH = path.join(
    process.cwd(),
    'Library', 'Mobile Documents', 'iCloud~md~obsidian', 'Documents', 'sasayoshi',
    '00_System', '00_UserProfile', '08_ã‚»ãƒ©ã®å­£ç¯€æ„Ÿ(Sera_Lifestyle).md'
);

// Fallback path if run from inside the prorenata project dir directly vs home dir
const ALT_LIFESTYLE_PATH = path.join(process.env.HOME || '/Users/sasakiyoshimasa', 'Library/Mobile Documents/iCloud~md~obsidian/Documents/sasayoshi/00_System/00_UserProfile/08_ã‚»ãƒ©ã®å­£ç¯€æ„Ÿ(Sera_Lifestyle).md');
const finalPath = fs.existsSync(ALT_LIFESTYLE_PATH) ? ALT_LIFESTYLE_PATH : LIFESTYLE_FILE_PATH;


// --- Determine Season ---
const currentMonth = new Date().getMonth() + 1;
let targetSeason = "";
if (currentMonth >= 3 && currentMonth <= 5) {
    targetSeason = "æ˜¥å‘ã‘";
} else if (currentMonth >= 6 && currentMonth <= 8) {
    targetSeason = "å¤å‘ã‘";
} else if (currentMonth >= 9 && currentMonth <= 11) {
    targetSeason = "ç§‹å‘ã‘";
} else {
    targetSeason = "å†¬å‘ã‘";
}

console.log(`ðŸŒ¸ Target Season determined: ${targetSeason} (Current Month: ${currentMonth})`);

// --- Prompt Definition ---
const generationPrompt = `
ã‚ãªãŸã¯20ä»£å¥³æ€§å‘ã‘ã®ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã«ç²¾é€šã—ãŸã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆå…¼ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã§ã™ã€‚
ç™½å´Žã‚»ãƒ©ï¼ˆ20æ­³ãƒ»å¥³æ€§ãƒ»çœ‹è­·åŠ©æ‰‹ï¼‰ã®ã€Œè¡£ãƒ»é£Ÿãƒ»ä½ã€ã®å­£ç¯€æ„Ÿè¨­å®šã®ã€Œ${targetSeason}ã€ã®æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ã‚»ãƒ©ã®ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ãƒ«ãƒ¼ãƒ«ï¼ˆçµ¶å¯¾åŽ³å®ˆï¼‰ã€‘
1. é…è‰²: æœè£…ã‚„å°ç‰©ã¯ã€Œæ·¡è‰²ç³»ï¼ˆã‚¢ã‚¤ãƒœãƒªãƒ¼ã€ã‚°ãƒ¬ãƒ¼ã‚¸ãƒ¥ã€ãƒšãƒ¼ãƒ«ãƒ–ãƒ«ãƒ¼ã€ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³ãªã©ï¼‰ã€é™å®šã€‚åŽŸè‰²ã‚„æ´¾æ‰‹ãªæŸ„ã¯NGã€‚
2. ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸: VISã€ROPE' PICNICã€SNIDELã€gelato piqueãªã©ã®ãƒªã‚¢ãƒ«ãª20ä»£å¥³æ€§ã®æ¸…æ¥šãƒ»ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã€‚
3. é£Ÿã¨ä½: å­£ç¯€ã«åˆã‚ã›ãŸã€Œå†·ãŸã„/æ¸©ã‹ã„ã€é£²ã¿ç‰©ã®æŒ‡å®šã€ã‚³ãƒ³ãƒ“ãƒ‹ã‚„ã‚¹ãƒ¼ãƒ‘ãƒ¼ã§è²·ãˆã‚‹å­£ç¯€ã®ã‚¹ã‚¤ãƒ¼ãƒ„ã€å®¶ã®å†·æˆ¿/æš–æˆ¿æ©Ÿå™¨ãªã©ã‚’å…·ä½“çš„ã«æŒ‡å®šã—ã€Amazonã‚„æ¥½å¤©ã§è‡ªç„¶ã«å•†å“ã‚’ç´¹ä»‹ã§ãã‚‹è§£åƒåº¦ã«ã—ã¦ãã ã•ã„ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
ä»¥ä¸‹ã®Markdownæ§‹é€ ã¨è¦‹å‡ºã—ï¼ˆ#ã‚„##ã®ãƒ¬ãƒ™ãƒ«ï¼‰ã‚’å®Œå…¨ã«å®ˆã£ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚ä½™è¨ˆãªæŒ¨æ‹¶ã‚„å‰ç½®ãã¯ä¸è¦ã§ã™ã€‚Markdownãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

# ã‚»ãƒ©ã®å­£ç¯€æ„Ÿãƒ»ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ« (Sera's Lifestyle Database)

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ç™½å´Žã‚»ãƒ©ï¼ˆ20ä»£å¥³æ€§ãƒ»çœ‹è­·åŠ©æ‰‹ï¼‰ã®å…·ä½“çš„ãªè¡£ãƒ»é£Ÿãƒ»ä½ã®å­£ç¯€æ„Ÿè¨­å®šã‚’å®šç¾©ã™ã‚‹è¾žæ›¸ã§ã™ã€‚
AIã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å­£ç¯€ãƒ»æ–‡è„ˆã«åˆã£ãŸã€Œæœè£…ãƒ»é£²ã¿ç‰©ãƒ»é£Ÿã¹ç‰©ãƒ»ã‚¤ãƒ³ãƒ†ãƒªã‚¢ã€ã‚’æŠ½å‡ºã—ã€æƒ…æ™¯æå†™ã¨ã—ã¦çµ„ã¿è¾¼ã¿ã¾ã™ã€‚

## ðŸŽ¨ åŸºæœ¬ãƒ«ãƒ¼ãƒ« (Style Rules)
*   **é…è‰²**: æœã‚„å°ç‰©ã¯æ·¡è‰²ç³»ï¼ˆã‚¢ã‚¤ãƒœãƒªãƒ¼ã€ã‚°ãƒ¬ãƒ¼ã‚¸ãƒ¥ãªã©ï¼‰ã€‚
*   **ãƒ†ã‚¤ã‚¹ãƒˆ**: æ¸…æ½”æ„Ÿã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã€é©åº¦ãªãƒˆãƒ¬ãƒ³ãƒ‰æ„Ÿã€‚
*   **ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«**: è±ªè¯ãªãƒ‡ã‚£ãƒŠãƒ¼ã‚ˆã‚Šã‚‚ã€Œä»•äº‹çµ‚ã‚ã‚Šã®ã‚³ãƒ³ãƒ“ãƒ‹ã‚¹ã‚¤ãƒ¼ãƒ„ã€ã‚„ã€Œä¼‘æ—¥ã®ã‚«ãƒ•ã‚§ã®å­£ç¯€é™å®šãƒ‰ãƒªãƒ³ã‚¯ã€ã€ã€ŒAmazonã§è²·ã£ãŸä¾¿åˆ©ãªå­£ç¯€å®¶é›»ã€ã«å¹¸ã›ã‚’æ„Ÿã˜ã‚‹ç­‰èº«å¤§ã®20ä»£ã€‚

---

## ðŸŒ» ä»Šå­£ã®ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ« (${targetSeason})

### ðŸ’¼ é€šå‹¤ãƒ»é€€å‹¤ (Commute)
å¤œå‹¤æ˜Žã‘ã®ç–²ã‚ŒãŸæœã‚„ã€å°‘ã—é›¨ã®é™ã‚‹å¤•æ–¹ã®ãƒã‚¹åœãªã©ã€‚
1.  **Coordinate A (ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´ã‚’ç°¡æ½”ã«)**
    *   **æœ**: ï¼ˆå…·ä½“çš„ãªè‰²ãƒ»å½¢ãƒ»ç´ æã€‚ä¾‹ï¼šã‚¢ã‚¤ãƒœãƒªãƒ¼ã®ãƒªãƒ–ãƒ‹ãƒƒãƒˆã¨ãƒ™ãƒ¼ã‚¸ãƒ¥ã®ãƒˆãƒ¬ãƒ³ãƒï¼‰
    *   **å°ç‰©**: ï¼ˆãƒãƒƒã‚°ã‚„å‚˜ãªã©ï¼‰
    *   **é£²ã¿ç‰©**: ï¼ˆä¾‹ï¼šã‚³ãƒ³ãƒ“ãƒ‹ã®ãƒ›ãƒƒãƒˆã‚³ãƒ¼ãƒ’ãƒ¼ã€ã¾ãŸã¯å†·ãŸã„ã‚¸ãƒ£ã‚¹ãƒŸãƒ³ãƒ†ã‚£ãƒ¼ï¼‰
    *   **é£Ÿã¹ç‰©**: ï¼ˆä¾‹ï¼šå¸°ã‚Šé“ã«è²·ã£ãŸè‚‰ã¾ã‚“ã€ã¾ãŸã¯æ¶¼ã—ã’ãªã‚¼ãƒªãƒ¼é£²æ–™ï¼‰
2.  **Coordinate B (ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´ã‚’ç°¡æ½”ã«)**
    *   **æœ**: (...)
    *   **å°ç‰©**: (...)
    *   **é£²ã¿ç‰©**: (...)
    *   **é£Ÿã¹ç‰©**: (...)

### â˜• ä¼‘æ—¥ã®ãŠå‡ºã‹ã‘ (Day Off)
ã‚«ãƒ•ã‚§ã§ã®ã‚“ã³ã‚Šã™ã‚‹æ—¥ã€è²·ã„ç‰©ã«å‡ºã‹ã‘ã‚‹æ—¥ã€‚
1.  **Coordinate C (ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´ã‚’ç°¡æ½”ã«)**
    *   **æœ**: ï¼ˆä¾‹ï¼šãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³ã®å°èŠ±æŸ„ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ï¼‰
    *   **å°ç‰©**: ï¼ˆä¾‹ï¼šã‚µãƒžãƒ³ã‚µã‚¿ãƒã‚µé¢¨ã®ãƒ”ãƒ³ã‚¯ã®ãƒŸãƒ‹ãƒãƒƒã‚°ï¼‰
    *   **é£²ã¿ç‰©**: ï¼ˆä¾‹ï¼šã‚«ãƒ•ã‚§ã®å­£ç¯€é™å®šãƒ•ãƒ©ãƒšãƒãƒ¼ãƒŽã€ã¾ãŸã¯æ¸©ã‹ã„ãƒãƒ£ã‚¤ãƒ©ãƒ†ï¼‰
    *   **é£Ÿã¹ç‰©**: ï¼ˆä¾‹ï¼šå­£ç¯€ã®ãƒ•ãƒ«ãƒ¼ãƒ„ã‚¿ãƒ«ãƒˆï¼‰
2.  **Coordinate D (ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´ã‚’ç°¡æ½”ã«)**
    *   (...)

### ðŸŒ™ éƒ¨å±‹ç€ãƒ»æ·±å¤œã®è‡ªå®¤ (Roomwear & Night Relax)
è‡ªå®¤ã§å¤œæ›´ã‹ã—ã™ã‚‹æ™‚ã‚„ã€ã‚¹ãƒžãƒ›ã‚’ã„ã˜ã‚ŠãªãŒã‚‰ãã¤ã‚ãæ™‚ã€‚
1.  **Coordinate E (ã‚¸ã‚§ãƒ©ãƒ”ã‚±é¢¨ã‚‚ã“ã‚‚ã“ç­‰ã®éƒ¨å±‹ç€ã®å…·ä½“ä¾‹)**
    *   **æœ**: ï¼ˆå…·ä½“çš„ãªéƒ¨å±‹ç€ã€‚ä¾‹ï¼šã‚¸ã‚§ãƒ©ãƒ”ã‚±é¢¨ã®æ·¡ã„ãƒ”ãƒ³ã‚¯ã®ã‚‚ã“ã‚‚ã“ãƒ‘ãƒ¼ã‚«ãƒ¼ï¼‰
    *   **éƒ¨å±‹ã®ç’°å¢ƒ**: ï¼ˆä¾‹ï¼šè¶³å…ƒã«ã¯å°ã•ãªé›»æ°—ãƒ’ãƒ¼ã‚¿ãƒ¼ã€ã¾ãŸã¯å†·æˆ¿ã‚’åŠ¹ã‹ã›ãŸæ¶¼ã—ã„éƒ¨å±‹ï¼‰
    *   **é£²ã¿ç‰©**: ï¼ˆä¾‹ï¼šãƒžã‚°ã‚«ãƒƒãƒ—ã§é£²ã‚€æ¸©ã‹ã„ãƒãƒ¼ãƒ–ãƒ†ã‚£ãƒ¼ã€ã¾ãŸã¯æ°·ã‚’å…¥ã‚ŒãŸéº¦èŒ¶ï¼‰
    *   **é£Ÿã¹ç‰©**: ï¼ˆä¾‹ï¼šã‚¹ãƒ¼ãƒ‘ãƒ¼ã§è²·ã£ãŸãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã€ã¾ãŸã¯æ¸©ã‹ã„ã‚¹ãƒ¼ãƒ—ï¼‰
2.  **Coordinate F (ã¡ã‚‡ã£ã¨ãã“ã¾ã§ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¦ã‚§ã‚¢)**
    *   **æœ**: (...)
    *   **éƒ¨å±‹ã®ç’°å¢ƒ**: (...)
    *   **é£²ã¿ç‰©**: (...)
    *   **é£Ÿã¹ç‰©**: (...)

ï¼ˆæŒ‡ç¤ºï¼‰ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã«å¾“ã„ã€()å†…ã‚’${targetSeason}ã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã«æ²¿ã£ãŸå…·ä½“çš„ãªã‚¢ã‚¤ãƒ†ãƒ åï¼ˆã‚·ã‚¢ãƒ¼ã‚·ãƒ£ãƒ„ã€ã‚·ãƒ£ã‚®ãƒ¼ãƒ‹ãƒƒãƒˆã€å­£ç¯€ã®ãƒ•ãƒ©ãƒšãƒãƒ¼ãƒŽã€ã“ãŸã¤ã€å†·é¢¨æ‰‡ãªã©ï¼‰ã§åŸ‹ã‚ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
`;

async function updateLifestyle() {
    try {
        const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-lite-001" });

        console.log("ðŸ¤– Generating new lifestyle content (clothes, food, drinks, living)...");
        const result = await model.generateContent(generationPrompt);
        const responseText = await result.response.text();
        const finalContent = responseText.trim().replace(/^```markdown\n/, '').replace(/```\n?$/, '');

        // Make sure directory exists if for some reason it doesn't
        fs.mkdirSync(path.dirname(finalPath), { recursive: true });

        // Overwrite the file completely
        fs.writeFileSync(finalPath, finalContent);
        console.log(`âœ… Successfully updated Sera's Lifestyle Database at: ${finalPath}`);

    } catch (e) {
        console.error("âŒ Failed to update lifestyle database:", e);
        process.exit(1);
    }
}

updateLifestyle();
