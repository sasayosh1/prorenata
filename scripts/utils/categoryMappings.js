const CATEGORY_NORMALIZATION_MAP = {
  '退職': '離職理由',
  '資格': '資格要件',
  '人間関係': 'チーム内の役割分担',
  '仕事内容': '業務範囲（療養生活上の世話）',
  '看護師': '看護師‐看護補助者の役割境界',
  '転職': '就業移動（転職）',
  '給与': '賃金水準',
  '感染対策': '医療関連感染対策',
  '悩み': '心理的負担（メンタル負担）',
  '患者対応': '患者ケア手順',
  '実務': '日常業務プロトコル'
}

const CATEGORY_KEYWORDS = {
  '離職理由': ['退職', '辞め', '辞める', '離職', '円満', '退社', '退職代行', '退職届', '退職願', '有給', '引き継ぎ'],
  '資格要件': ['資格', '取得', '受験', '勉強', '講座', '研修', '検定', '合格', '通信', '模試', '学習'],
  'チーム内の役割分担': ['人間関係', '上司', '先輩', '同僚', 'スタッフ', 'チーム', '人付き合い', '関係性', 'トラブル', '雰囲気', '連携'],
  '業務範囲（療養生活上の世話）': ['仕事内容', '業務内容', '役割', '職務', '1日', 'スケジュール', 'できる', 'できない', '種類', '働き方', 'とは', '療養'],
  '看護師‐看護補助者の役割境界': ['看護師', '准看', '正看', '看護学校', '看護学生', '看護サービス', '境界', '役割分担'],
  '就業移動（転職）': ['転職', '就職', '応募', '履歴書', '面接', '求人', '派遣', '志望動機', '内定', 'エージェント', '職務経歴書'],
  '賃金水準': ['給料', '給与', '年収', '月給', '時給', '賞与', 'ボーナス', '手当', '待遇', '収入', '賃金', '昇給'],
  '医療関連感染対策': ['感染', '衛生', '消毒', 'マスク', '防護', '予防', '清潔', '手洗い', '除菌', 'コロナ', 'インフル', '防護具', '感染症'],
  '心理的負担（メンタル負担）': ['悩み', '相談', 'ストレス', '不安', '心配', '精神的', '負担', 'メンタル', 'つらい', '疲れ', '落ち込む'],
  '患者ケア手順': ['患者', '患者さん', '接遇', '声かけ', '案内', '安心', '傾聴', 'コミュニケーション', 'ケア', '手順'],
  '日常業務プロトコル': ['実務', '現場', 'ノウハウ', '介助', '体位変換', '清拭', '排泄', '口腔ケア', '物品', 'シーツ', '記録', 'バイタル', '環境整備', '準備', '手順']
}

const CATEGORY_DESCRIPTIONS = {
  '離職理由': '厚生労働省の統計（賃金構造基本統計調査等）を基に看護助手の離職背景を整理するカテゴリです。',
  '資格要件': '日本看護協会が示す看護補助者の資格・研修要件を参照し、学びや取得方法を整理します。',
  'チーム内の役割分担': '日本看護協会の看護補助者活用ガイドラインを根拠に、チーム内での連携や人間関係を扱います。',
  '業務範囲（療養生活上の世話）': '厚生労働省「職業情報提供サイト（看護助手）」を基に、療養生活上の世話に関する業務範囲をまとめます。',
  '看護師‐看護補助者の役割境界': '日本看護協会の看護サービス提供に関する資料を参照し、看護師と看護補助者の役割境界を整理します。',
  '就業移動（転職）': '厚生労働省の統計データを参照し、就業移動・転職動向を扱います。',
  '賃金水準': '厚生労働省「賃金構造基本統計調査」に基づき、賃金・給与データを扱います。',
  '医療関連感染対策': '厚生労働省および国立感染症研究所の公開資料に基づき、感染対策を整理します。',
  '心理的負担（メンタル負担）': '日本看護協会の資料を参照し、看護補助者の心理的負担やメンタルケアを扱います。',
  '患者ケア手順': '日本看護協会が示す療養生活上の世話ガイドラインを参照し、患者ケア手順を整理します。',
  '日常業務プロトコル': '日本看護協会および厚生労働省の資料に基づき、日常業務の手順・プロトコルを扱います。'
}

const CATEGORY_REFERENCE_SNIPPETS = {
  '離職理由': '本稿の離職理由に関するデータ・数字は厚生労働省（例：賃金構造基本統計調査）に基づきます。',
  '資格要件': '本稿の資格要件に関する基準・定義は日本看護協会が公開する看護補助者関連ガイドラインを参照しています。',
  'チーム内の役割分担': '本稿の役割分担に関する説明は日本看護協会が示す看護チームの役割分担整理をもとに記載しています。',
  '業務範囲（療養生活上の世話）': '本稿の業務範囲に関する説明は厚生労働省「職業情報提供サイト（看護助手）」に基づいています。',
  '看護師‐看護補助者の役割境界': '本稿の役割境界に関する整理は日本看護協会の看護サービス提供に関するガイドラインを参照しています。',
  '就業移動（転職）': '本稿の就業移動・転職の傾向や数値は厚生労働省の統計資料をもとに解説しています。',
  '賃金水準': '本稿の賃金水準に関する平均額は厚生労働省「賃金構造基本統計調査」を出典としています。',
  '医療関連感染対策': '本稿の感染対策に関する内容は厚生労働省および国立感染症研究所の公開資料に基づきます。',
  '心理的負担（メンタル負担）': '本稿の心理的負担に関する解説は日本看護協会が示す看護補助者の役割整理をもとにしています。',
  '患者ケア手順': '本稿の患者ケアに関する業務内容は日本看護協会が示す「療養生活上の世話」に関するガイドラインを参照しています。',
  '日常業務プロトコル': '本稿の実務上の手順に関する説明は日本看護協会や厚生労働省の公開資料を出典としています.'
}

const CANONICAL_CATEGORY_TITLES = Array.from(
  new Set([
    ...Object.values(CATEGORY_NORMALIZATION_MAP),
    ...Object.keys(CATEGORY_DESCRIPTIONS)
  ])
)

function normalizeCategoryTitle(title = '') {
  return CATEGORY_NORMALIZATION_MAP[title] || title
}

function extractCategoryTitle(category) {
  if (!category) return ''
  if (typeof category === 'string') return category
  if (typeof category.title === 'string') return category.title
  if (typeof category.name === 'string') return category.name
  return ''
}

function getNormalizedCategoryTitles(categories = []) {
  return categories
    .map(extractCategoryTitle)
    .map(title => normalizeCategoryTitle(title))
    .map(title => (title || '').trim())
    .filter(Boolean)
}

module.exports = {
  CATEGORY_NORMALIZATION_MAP,
  CATEGORY_KEYWORDS,
  CATEGORY_DESCRIPTIONS,
  CATEGORY_REFERENCE_SNIPPETS,
  CANONICAL_CATEGORY_TITLES,
  normalizeCategoryTitle,
  getNormalizedCategoryTitles
}
