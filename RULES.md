# 運用ルール（Google / アフィリエイト監視）

## チェック頻度
- **毎日（営業日ベース）** : Google Search Console / Google Analytics / Google AdSense / アフィリエイト管理画面
- **随時** : 重大な通知メールを受け取った際は即確認

## 1. Google Search Console
1. `https://search.google.com/search-console` にログイン
2. プロパティ `sasakiyoshimasa.com` / `prorenata.jp` を切り替えて確認
3. 確認する項目
   - **カバレッジ** : エラー URL がないか
   - **ステータス通知** : セキュリティ問題、手動対策が出ていないか
   - **インデックス登録** : 新規記事の URL がインデックスされているか（必要に応じて「URL 検査」→「インデックス登録をリクエスト」）
4. 異常時対応
   - エラー URL を修正（リダイレクト / noindex / HTML 修正など）
   - 手動対策が出た場合は原因を特定し修正後「審査をリクエスト」
   - セキュリティ問題は該当ページを調査し、原因を除去後に再審査依頼

## 2. Google Analytics（GA4）
1. `https://analytics.google.com/analytics/web/`
2. プロパティ `sasakiyoshimasa.com` / `prorenata` を確認
3. 主要指標
   - リアルタイムユーザー数（0が続いた場合、計測タグを疑う）
   - 直近日のセッション数・イベント計測状況
   - 設定 > データストリームから「過去 48 時間に受信したイベント」
4. 異常時対応
   - サイトの `<head>` に GA4 タグが残っているか確認（タブ：Network で `collect` 送信を確認）
   - vtag / consent 表示などでブロックされていないか確認
   - `measurement_id` が .env / 環境変数と一致しているか確認

## 3. Google AdSense
1. `https://www.google.com/adsense/`
2. アカウントのホーム画面アラートを確認（ads.txt / ポリシー違反など）
3. 推定収益が 0 の日が続く場合は広告配信状況を確認
4. 異常時対応
   - ads.txt の警告 → `public/ads.txt` / デプロイ先のルートに正しい `ca-pub-xxxxx` を記載し 24-48h 待機
   - ポリシー違反 → 該当ページを修正し再審査
   - 広告配信が完全停止 → サイトの自動広告設定 / 広告ユニットのコード有無を確認

## 4. アフィリエイトリンク
- 主要 ASP の管理画面（例：A8.net、もしもアフィリエイト等）にログイン
- クリック数 / 成果が異常に 0 の場合、リンク落ちを疑う
- ルーティング確認
  - ブラウザでリンククリック → 正しい LP に遷移するか
  - `rel="nofollow"` `rel="sponsored"` が付いているか
- 期限切れ広告は差し替え
- **🔐 収益最重要記事の絶対保護**
  - 以下の2記事は絶対に編集してはいけない: `nursing-assistant-compare-services-perspective`, `comparison-of-three-resignation-agencies`
  - 詳細は [CLAUDE.md](./CLAUDE.md) の「⚠️ 重要なルール」セクションを参照
- **資格カテゴリ専用ルール**  
  - 「資格」「資格手当」など資格関連のセクションでは、指定案件が届くまでアフィリエイトリンクを挿入しない。  
  - 転職案件（例：かいご畑）を資格セクションに流用しないこと。ユーザーニーズと一致しないため禁止。  
  - 指定案件が共有されたら必ず `RULES.md` を更新し、適用条件を明記する。
- **転職案件の扱い**  
  - 個別の ASP 紐づけリンク（例：かいご畑カード）は原則禁止。  
  - 転職需要の訴求は内部記事「看護助手の転職サービス３社を “看護助手の視点だけ” で比較」（slug: `nursing-assistant-compare-services-perspective`）への内部リンクで集約し、そこから収益化する。  
  - メンテナンススクリプトや自動生成でも外部転職案件を挿入しない実装にしておくこと。
- **本文構成ルール**
  - リード（導入文）に参考リンク・出典リンクは置かない。参考・出典は該当セクション末尾または記事末尾でまとめる。
  - H2 直下（1行目）に参考リンクを置かない。本文を書いてから、必要に応じて段落末に参考リンクを付す。
  - 参考リンクは「そのセクションの末尾」に置く。配置順は ①参考リンク ②内部リンク ③アフィリエイトリンク（ナースリー/Amazon・楽天）の順とする。
  - 参考リンクは各セクション1つまで。複数ある場合は1つに集約し、残りは削除または本文に統合する。
  - **参考/出典の禁止位置**: リード（最初のH2より前）と、H2直下（1行目）に「参考:」「出典:」を置かない。
  - リード文で「この記事では〜」と続く場合、直前で改行して2段落に分け、読みやすさを担保する。
  - 各セクションは必ず「主張 → 理由（必要なら箇条書き） → 主張のフォロー」という流れで記述する。
  - セクション冒頭を箇条書きから始めない。段落で背景や主張を提示してから箇条書きに入る。
  - セクションの末尾を箇条書きで終えない。箇条書き後はまとめや次の行動につながる文章で締める。
  - 箇条書きのみで構成されたセクションは禁止。必ず前後に本文を挿入する。
  - 文体は丁寧さを保ちつつ、短文で「です。」「ます。」が続いて幼くならないよう、文を自然につなげたり語尾を少し変化させる（例: 「〜ですね」「〜かもしれません」「〜すると安心です」）。
  - **話者・禁止表現（全記事共通）**
    - 一人称は必ず「わたし」。「私」「俺」「僕」は使わない。
    - 禁止: タイトルや本文で「看護助手の私が教える、」のような肩書き主張を入れる。
    - 禁止: 文章内で自分の名前を出す（例: 「セラが」「セラの」「白崎セラです」など）。必要なら「わたし」で表現する。
- **まとめセクション**
  - 「参考」「出典」などの情報源ブロックは必ず本文の該当セクション内に配置し、まとめ直後には置かない。
  - まとめの後にはアフィリエイトカード→免責事項→その他ナビという既定の順序を守る。
  - **転職/退職アフィリエイトの禁止**: `nursing-assistant-compare-services-perspective` と `comparison-of-three-resignation-agencies` 以外の記事では、関連キーワードがあっても転職・退職代行のアフィリエイトを単体で貼らない。貼る場合は、該当2記事への内部リンクで集約する。
- **自己参照リンク禁止**
  - 記事内に自分自身への内部リンクを設置しない。
  - 比較記事（転職サービス３社比較、退職代行３社比較など）自体が目的地なので、自己参照は不要。
  - 内部リンク追加時は必ずリンク先が現在の記事（`slug`）と異なることを確認する。
  - ユーザーが同じページ内でループし、離脱率上昇・UX低下の原因となるため厳禁。

## 5. 共通ログ・モニタリング
- Vercel 監視：`https://vercel.com/sasayoshis-projects` の `toyamablog` / `prorenata` のデプロイ状況
- エラーログ：`npm run lint` / `npm run build` で開発時に検知したエラーを GitHub issue 等で記録

## 6. 緊急時連絡フロー
1. 発見時に Slack / メールでサイト名・事象・影響範囲を共有
2. 応急処置 → 再発防止策 → ルール更新（必要なら本書を更新）

## 7. 大規模スクリプト実行時の安全ルール
- 詳細は [CLAUDE.md](./CLAUDE.md) の「⚠️ 重要なルール」>「指定された作業以外のコード変更は絶対禁止」を参照
- **簡易チェックリスト**:
  1. ドライラン（`--dry-run`）で影響範囲を確認
  2. 少数記事（1-3件）でテスト実行
  3. 収益最重要記事（`PROTECTED_REVENUE_SLUGS`）をスキップ
  4. `maintenanceLocked: true` 記事をスキップ
  5. ログを確認し、意図しない変更がないか検証

## 8. SEOスクリプト実行時の検証ルール
- **実行前の必須チェック**: SEO改善スクリプト（タイトル変更、内部リンク追加、コンテンツ追記等）を実行する前に、必ず以下を実行すること
  ```bash
  node scripts/seo/validate-article-structure.js
  ```
- **検証内容**:
  - 免責事項の後にコンテンツがないか
  - 自己参照リンクがないか
  - RULES.mdの記事構造ルールに準拠しているか
- **違反発見時の対応**:
  - `scripts/seo/fix-article-structure-v2.js`: 免責事項後のコンテンツを削除
  - `scripts/seo/remove-self-references.js`: 自己参照リンクを削除
- **再発防止**: スクリプトは記事の末尾（免責事項の後）ではなく、適切な位置（まとめの前、H2/H3セクション内等）にコンテンツを挿入すること

## 9. ドキュメント更新
- ルール変更時は `RULES.md` を更新し、変更ログ（日時・変更者・内容）を記録
- 変更内容はチームに共有

## 変更履歴

### 2025-12-03: SEOスクリプト検証ルール追加
- SEO改善スクリプト実行前の検証を義務化
- 記事構造違反（免責事項後コンテンツ、自己参照リンク）の防止策を明文化
- 検証・修正スクリプトの使用方法を追記
