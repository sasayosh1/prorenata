# 運用ルール（Google / アフィリエイト監視）

## チェック頻度
- **毎日（営業日ベース）** : Google Search Console / Google Analytics / Google AdSense / アフィリエイト管理画面
- **随時** : 重大な通知メールを受け取った際は即確認

## 1. Google Search Console
1. `https://search.google.com/search-console` にログイン
2. プロパティ `sasakiyoshimasa.com` / `prorenata.jp` を切り替えて確認
3. 確認する項目
   - **カバレッジ** : エラー URL がないか
   - **ステータス通知** : セキュリティ問題、手動対策が出ていないか
   - **インデックス登録** : 新規記事の URL がインデックスされているか（必要に応じて「URL 検査」→「インデックス登録をリクエスト」）
4. 異常時対応
   - エラー URL を修正（リダイレクト / noindex / HTML 修正など）
   - 手動対策が出た場合は原因を特定し修正後「審査をリクエスト」
   - セキュリティ問題は該当ページを調査し、原因を除去後に再審査依頼

## 2. Google Analytics（GA4）
1. `https://analytics.google.com/analytics/web/`
2. プロパティ `sasakiyoshimasa.com` / `prorenata` を確認
3. 主要指標
   - リアルタイムユーザー数（0が続いた場合、計測タグを疑う）
   - 直近日のセッション数・イベント計測状況
   - 設定 > データストリームから「過去 48 時間に受信したイベント」
4. 異常時対応
   - サイトの `<head>` に GA4 タグが残っているか確認（タブ：Network で `collect` 送信を確認）
   - vtag / consent 表示などでブロックされていないか確認
   - `measurement_id` が .env / 環境変数と一致しているか確認

## 3. Google AdSense
1. `https://www.google.com/adsense/`
2. アカウントのホーム画面アラートを確認（ads.txt / ポリシー違反など）
3. 推定収益が 0 の日が続く場合は広告配信状況を確認
4. 異常時対応
   - ads.txt の警告 → `public/ads.txt` / デプロイ先のルートに正しい `ca-pub-xxxxx` を記載し 24-48h 待機
   - ポリシー違反 → 該当ページを修正し再審査
   - 広告配信が完全停止 → サイトの自動広告設定 / 広告ユニットのコード有無を確認

## 4. アフィリエイトリンク
- 主要 ASP の管理画面（例：A8.net、もしもアフィリエイト等）にログイン
- クリック数 / 成果が異常に 0 の場合、リンク落ちを疑う
- ルーティング確認
  - ブラウザでリンククリック → 正しい LP に遷移するか
  - `rel="nofollow"` `rel="sponsored"` が付いているか
- 期限切れ広告は差し替え
- **🔐 収益最重要記事の絶対保護**
  - 以下の2記事は **maintenanceLockedフラグの状態に関わらず、絶対に編集してはいけない**
    - `nursing-assistant-compare-services-perspective`（看護助手の転職サービス３社比較）
    - `comparison-of-three-resignation-agencies`（退職代行３社のメリット・デメリット徹底比較）
  - これらは収益最適化のための最重要記事
  - スクリプト実行時は必ず `PROTECTED_REVENUE_SLUGS` でチェックし、該当記事をスキップすること
  - 違反すると収益損失の最重大インシデントとなる
- **資格カテゴリ専用ルール**  
  - 「資格」「資格手当」など資格関連のセクションでは、指定案件が届くまでアフィリエイトリンクを挿入しない。  
  - 転職案件（例：かいご畑）を資格セクションに流用しないこと。ユーザーニーズと一致しないため禁止。  
  - 指定案件が共有されたら必ず `RULES.md` を更新し、適用条件を明記する。
- **転職案件の扱い**  
  - 個別の ASP 紐づけリンク（例：かいご畑カード）は原則禁止。  
  - 転職需要の訴求は内部記事「看護助手の転職サービス３社を “看護助手の視点だけ” で比較」（slug: `nursing-assistant-compare-services-perspective`）への内部リンクで集約し、そこから収益化する。  
  - メンテナンススクリプトや自動生成でも外部転職案件を挿入しない実装にしておくこと。
- **本文構成ルール**
  - 各セクションは必ず「主張 → 理由（必要なら箇条書き） → 主張のフォロー」という流れで記述する。
  - セクション冒頭を箇条書きから始めない。段落で背景や主張を提示してから箇条書きに入る。
  - セクションの末尾を箇条書きで終えない。箇条書き後はまとめや次の行動につながる文章で締める。
  - 箇条書きのみで構成されたセクションは禁止。必ず前後に本文を挿入する。
- **自己参照リンク禁止**
  - 記事内に自分自身への内部リンクを設置しない。
  - 比較記事（転職サービス３社比較、退職代行３社比較など）自体が目的地なので、自己参照は不要。
  - 内部リンク追加時は必ずリンク先が現在の記事（`slug`）と異なることを確認する。
  - ユーザーが同じページ内でループし、離脱率上昇・UX低下の原因となるため厳禁。

## 5. 共通ログ・モニタリング
- Vercel 監視：`https://vercel.com/sasayoshis-projects` の `toyamablog` / `prorenata` のデプロイ状況
- エラーログ：`npm run lint` / `npm run build` で開発時に検知したエラーを GitHub issue 等で記録

## 6. 緊急時連絡フロー
1. 発見時に Slack / メールでサイト名・事象・影響範囲を共有
2. 応急処置 → 再発防止策 → ルール更新（必要なら本書を更新）

## 7. 大規模スクリプト実行時の安全ルール（最重要）
- **背景**: 過去に新しいスクリプトや大規模スクリプトを走らせた際、指示していない部分を改変・削除してしまい、最重大インシデントになった事例が多数ある
- **絶対厳守事項**:
  1. **指示された作業以外の部分は絶対に触らない**
  2. 大規模な一括修正スクリプトを作成・実行する前に、以下を必ず確認:
     - 修正対象フィールドを明確化（例: body内のH3セクション末尾のみ）
     - 修正対象外フィールドを明確化（例: title, excerpt, categories, tags等は一切触らない）
     - 収益最重要記事（`PROTECTED_REVENUE_SLUGS`）は必ずスキップ
     - `maintenanceLocked: true` 記事は必ずスキップ
  3. スクリプト実行前に必ず以下を実施:
     - ドライラン（`--dry-run`）で影響範囲を確認
     - 少数記事（1-3件）でテスト実行
     - 問題がないことを確認してから全件実行
  4. スクリプト実行中・実行後のチェック:
     - ログを必ず確認し、意図しない変更がないか検証
     - 修正前後の差分を必ず確認
     - 問題があればすぐに停止し、ロールバック
  5. 実行ログ・影響範囲を `PROJECT_STATUS.md` または CLAUDE.md に記録
- **違反時の対応**: 最重大インシデントとして扱い、即座にロールバック・復旧作業を実施

## 8. ドキュメント更新
- ルール変更時は `RULES.md` を更新し、変更ログ（日時・変更者・内容）を記録
- 変更内容はチームに共有
