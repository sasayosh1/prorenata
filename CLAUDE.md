# Claude Code プロジェクト設定

## ⚠️ Claude Codeへの重要な指示

### 「全部保存」コマンドの動作

ユーザーが「全部保存」と指示した時は、以下の手順を**必ず実行**すること：

1. **コード変更をgitコミット＆プッシュ**
   ```bash
   git add -A
   git commit -m "適切なコミットメッセージ"
   git push
   ```

2. **CLAUDE.mdの更新**
   - 「## 最近の変更」セクションに新しいエントリーを追加
   - 日付、変更内容、目的、効果を記録
   - 番号付きリストで整理（例: 5. 💰 **タイトル** (YYYY-MM-DD)）

3. **該当する場合は関連ドキュメントも更新**
   - 自動実行スケジュールの変更 → 該当セクションを更新
   - 重要なルール追加 → 「⚠️ 重要なルール」セクションに追加
   - コマンド変更 → 「開発コマンド」セクションを更新

4. **更新したドキュメントもコミット＆プッシュ**
   ```bash
   git add CLAUDE.md (その他のドキュメント)
   git commit -m "ドキュメント更新"
   git push
   ```

**重要**: ユーザーが明示的に「全部保存」と言った場合、上記の手順をすべて実行し、「✅ すべて保存完了」と報告すること。

---

## 開発コマンド

### 開発サーバー起動
```bash
npm run dev
```
ローカル開発サーバーを起動します（通常はhttp://localhost:3000）

### Sanity Studio起動
```bash
npx sanity dev --port 3333
```
SanityのCMSスタジオを起動します（http://localhost:3333）

### ビルド
```bash
npm run build
```
本番用ビルドを作成します

### 型チェック
```bash
npm run type-check
```
TypeScriptの型チェックを実行します

### リント
```bash
npm run lint
```
コードのリント（構文チェック）を実行します

## デプロイ

### Vercelデプロイ
```bash
vercel
```
Vercelに本番デプロイします

### プレビューデプロイ
```bash
vercel --previewe
```
プレビュー環境にデプロイします

## プロジェクト概要

- **サイト名**: ProReNata
- **用途**: 看護助手向け情報サイト
- **技術**: Next.js 15.5.2 + Sanity CMS + TypeScript
- **デザイン**: sasakiyoshimasa.comスタイルのミニマルデザイン
- **本番URL**: https://prorenata.jp

## 記事作成ガイドライン

**記事作成の際は以下のドキュメントを参照**：
- **記事テンプレート**: `/Users/user/Documents/sasakiyoshimasa_article_template_codex.md`
  - 記事構成の基本フォーマット
  - 見出し・本文の書き方ルール
  - SEO最適化ガイドライン
  - 記事タイプ別テンプレート（4種類）

- **記事作成ガイド**: `ARTICLE_GUIDE.md`（プロジェクトルート）
  - Sanity CMSでの記事作成手順
  - 公開前チェックリスト
  - 品質基準・執筆ルール

**記事品質基準**：
- 文字数: 1500〜2500文字
- 見出し: H2を3〜5個使用
- 具体性: 数字・事例を含む
- SEO: タイトル30〜40文字、ディスクリプション120〜160文字

## 記事自動生成戦略

**詳細**: `docs/ARTICLE_GENERATION_STRATEGY.md` を参照

### 自動実行スケジュール

**1. 記事自動生成**
- **実行時刻**: 毎週 月曜 深夜2:00 (JST)
- **実行頻度**: 週1回（月4-5回）
- **ワークフロー**: `.github/workflows/daily-draft.yml`
- **生成エンジン**: Gemini API (gemini-1.5-flash-latest) ⚠️ **Pro禁止**
- **API キー**: GitHub Secrets (`GEMINI_API_KEY`) に設定済み
- **月間コスト**: 約¥6-10（Flash使用時）

**2. メンテナンスチェック**
- **実行時刻**: 毎週 月曜 深夜3:00 (JST) - 記事生成の1時間後
- **実行頻度**: 週1回（月4-5回）
- **ワークフロー**: `.github/workflows/daily-maintenance.yml`
- **内容**: 全記事の品質チェック（必須フィールド、SEO、文字数など）
- **コスト**: 無料（Gemini API未使用、Sanity APIとキーワードマッチングのみ）

**3. X自動投稿**
- **実行時刻**: 毎日 PM8:30-PM9:30の間（ランダム、スパム対策）
- **実行頻度**: 毎日（月30回）
- **ワークフロー**: `.github/workflows/daily-x-post.yml`
- **内容**: ランダム記事をX（Twitter）に自動投稿
- **生成エンジン**: Gemini API (gemini-1.5-flash-latest) ⚠️ **Pro禁止**
- **月間コスト**: 約¥15-45（Flash使用時、120-140文字要約生成）

### キーワード戦略（黄金比）

**ショート1：ミドル3：ロング5**

| キーワードタイプ | 割合 | 記事数目安（150記事中） | 狙い |
|----------------|------|---------------------|------|
| ショートテール | 10-15% | 15〜20記事 | カテゴリ／ガイドページ |
| ミドルテール | 35-40% | 50〜60記事 | **主力トラフィック獲得** |
| ロングテール | 45-55% | 70〜80記事 | CVR・E-E-A-T強化 |

**現在の重点**: ミドルテールを積極的に拡充し、トピッククラスターを形成

## 最近の変更

1. 🎨 **フロントエンドデザイン完成** (2025-09-12)
   - Tailwind Next.js Starter Blogデザインの完全再現
   - 薄いグレー文字問題を根本解決
   - カスタムCSSを削除、Tailwind標準クラスのみ使用

2. 🔒 **UI変更永久禁止**
   - UI-DESIGN-LOCK.mdファイル追加
   - 今後はフロントエンドデザインの変更を完全禁止
   - 機能追加・コンテンツ改善のみ許可

3. ✅ **Google Search Console設定完了** (2025-09-15)
   - DNS TXT方式で所有権確認成功
   - 確認コード: google-site-verification=Xy7fDHrYsVObXVQeb0D3He2wEWQCSnlsClAJ_OYsioE
   - プロパティ: https://prorenata.jp

4. 🚨 **プレビューボタン重大インシデント対応完了** (2025-09-27)
   - Sanity Studio プレビューボタン機能が完全消失（重大インシデント）
   - 緊急復旧: `src/sanity/actions/PreviewAction.tsx` を再作成
   - `sanity.config.ts` の PreviewAction 設定を再構築
   - 今後の予防策をCLAUDE.mdに追記（削除・変更の完全禁止）

5. 💰 **記事生成頻度の最適化とコスト削減** (2025-10-25)
   - 記事自動生成を毎日実行から週3回（水・土・日）に変更
   - Gemini API使用料を60%削減（¥147/月 → ¥59/月）
   - 全費用の100%がGemini APIによるものと判明
   - 夜間スクリプト群の包括的改善を実施：
     - Gemini APIモデルをgemini-2.5-flashに統一
     - 記事生成失敗時のGitHub Issue自動作成機能追加
     - X投稿の重複回避機構実装（30日履歴管理）
     - excerpt自動更新機能追加（白崎セラ口調で一貫性保持）

6. 👤 **白崎セラのプロフィールページ実装とキャラクター設定拡充** (2025-10-26)
   - aboutページに白崎セラのプロフィールカード追加
     - プロフィール画像（円形デザイン、グラデーション背景）
     - 基本情報（年齢、職業、活動内容）の視覚的表示
     - レスポンシブ対応（モバイル/デスクトップ最適化）
   - キャラクター設定に「お金との向き合い方」を追加
     - 奨学金・補助金は返済まで見据えて判断
     - 家計管理や投資について学び、実践する姿勢
     - 「今だけでなく、未来の自分も守る」金銭感覚
   - Sanity APIトークンエラー修正（GitHub Secrets更新）

7. 🔐 **セキュリティインフラ完全構築** (2025-10-26)
   - 5層のセキュリティ保護システム構築完了
   - **ローカル保護（3層）**:
     - `.gitignore` 更新: `.env*`, `*.secret`, `*.private` を除外
     - Git pre-commit フック: 秘密情報検出・コミット阻止（APIキーパターン検出）
     - direnv 導入: `.env.local` 自動読み込み（プロジェクト入室時）
     - `~/.env_keys` 作成: 全APIキー一元管理（chmod 600）
   - **GitHub保護（2層）**:
     - Secret Scanning 有効化: リポジトリ全体スキャン
     - Push Protection 有効化: プッシュ時秘密情報検査
     - GitHub Actions Secrets 登録: OPENAI_API_KEY, ANTHROPIC_API_KEY, GEMINI_API_KEY
   - **ビルドワークフロー追加**:
     - `.github/workflows/build.yml` 作成
     - Node.js 20 + npm でビルド
     - メモリ上限4GB設定 (--max-old-space-size=4096)
     - ビルド時に全APIキーを環境変数として注入

8. ⏰ **ワークフロー実行スケジュール最適化** (2025-10-26)
   - ワークフロー実行時間を整理・最適化
   - **記事自動生成**: 月・水・金 AM3:00 → **月・水・金 AM2:00** に変更（1時間前倒し）
   - **メンテナンスチェック**: 毎日 AM2:00 → **月・水・金 AM3:00** に変更（記事生成の1時間後、頻度削減）
   - **X自動投稿**: 毎日 PM8:30-PM9:30の間でランダム投稿（スパム対策、変更なし）
   - 目的: 記事生成後すぐにメンテナンスチェックを実行し、効率化

9. 🔧 **記事自動生成の認証エラー修正** (2025-10-26)
   - **問題**: ワークフローは成功表示だが実際には記事が生成されていなかった
   - **原因**: SANITY_WRITE_TOKEN が期限切れ（401 Unauthorized エラー）
     - ワークフローの `continue-on-error: true` により失敗が隠蔽されていた
   - **対応**:
     - 新しい Sanity API トークンを発行
     - GitHub Secrets の SANITY_WRITE_TOKEN を更新
     - `.env.local` にも SANITY_WRITE_TOKEN を追加
     - ローカル・GitHub Actions 両方でテスト成功確認
   - **結果**: 記事自動生成が正常に動作開始
     - ローカルテスト: drafts.9d8dddf8-d2b7-480c-92b6-4c1725837885
     - GitHub Actions: drafts.73924fd4-b938-4911-aadf-9549d306ef08

10. 🔑 **ローカル環境の Sanity トークン設定** (2025-10-26)
   - **問題**: ローカルスクリプトで Sanity API 401/403 エラーが発生
     - セキュリティインフラ構築時に `~/.env_keys` に Sanity トークンが未登録
     - `scripts/maintenance.js` など編集系スクリプトが実行不可
   - **対応**:
     - `~/.env_keys` に SANITY_WRITE_TOKEN と SANITY_API_TOKEN を追加
     - `.env.template` に Sanity トークン項目を追加
     - `scripts/test-sanity-write.js` 追加（書き込み権限テスト用）
     - Pre-commit フック修正：`.env.template` を除外リストに追加
   - **結果**: ローカル環境で Sanity API への書き込み権限が正常に動作

11. ✨ **メンテナンススクリプトの白崎セラ口調対応** (2025-10-26)
   - **追加ファイル**: `scripts/utils/postHelpers.js` 作成
     - `blocksToPlainText`: body ブロックをプレーンテキストに変換（リンクURLは除去）
     - `generateExcerpt`: 白崎セラ口調で excerpt を生成（100-150文字）
     - `generateMetaDescription`: 白崎セラ口調で metaDescription を生成（100-180文字、excerpt とは別）
     - `generateSlugFromTitle`: タイトルから URL スラッグを生成
     - `selectBestCategory`: タイトル・本文から最適なカテゴリを自動選択
   - **変更内容**:
     - excerpt と metaDescription を明確に区別（metaDescription は excerpt の要約版ではない）
     - カテゴリが空の場合、既存17種類のカテゴリから最適なものを自動選択
     - Meta Description 長さ基準を緩和（120-160文字 → 100-180文字、ユーザビリティやSEO優先）
   - **白崎セラ口調の実装**:
     - 導入フレーズ: 「看護助手として働く中で」「わたしの経験から」など
     - 締めフレーズ: 「現場目線で詳しくお伝えします」「無理なく続けるヒントをお届けします」など
     - 穏やかで丁寧、柔らかいが芯の通った口調を維持

12. 🔗 **アフィリエイトリンクチェックの最適化** (2025-10-26)
   - **変更内容**: メンテナンススクリプトのアフィリエイトリンクチェック機能を最適化
     - ASPアフィリエイト2個超過チェックを削除（ユーザビリティ優先）
     - 複数ASP（転職サイト、退職代行など）の混在は問題なしとして扱う
     - 関連性の低いリンク検出（例: 面接記事に退職代行リンク）は維持
   - **追加ファイル**: `scripts/link-summary.js` 作成
     - 全記事のリンク実装状況を集計（内部リンク、アフィリエイトリンク、外部リンク）
     - 実装率、総数、平均値を表示
   - **現状分析結果**（総記事数145件）:
     - 内部リンク: 95%実装、平均7.0個/記事（推奨2-3個より多い）
     - アフィリエイトリンク: 77%実装、平均1.1個/記事（適切）
     - 外部リンク（出典）: 12%実装、平均0.2個/記事（**要改善**）

13. 🐛 **ワークフローのエラー隠蔽バグ修正** (2025-10-26)
   - **発覚した問題**:
     - 記事自動生成が `continue-on-error: true` により失敗を隠蔽していた
     - SANITY_WRITE_TOKEN エラーが発生していたが、ワークフローは成功判定
     - GitHub Issue が作成されず、エラーに気づけない状態だった
     - 毎日実行される設定になっていた（本来は月・水・金のみ）
   - **修正内容**:
     - `.github/workflows/daily-draft.yml` から `continue-on-error: true` を削除
     - `.github/workflows/daily-maintenance.yml` から `continue-on-error: true` を削除
     - エラー発生時に `failure()` が正しく検出され、GitHub Issue が自動作成されるように改善
     - cron設定を毎日実行（`* * *`）から月・水・金（`1,3,5`）に修正済み（別コミット）
   - **結果**: エラー検出が正常に機能し、問題発生時に即座に通知されるように改善

14. 🚨 **メンテナンススクリプトが実行されていなかった重大バグ修正** (2025-10-26)
   - **発覚した問題**:
     - GitHub Actions で `node scripts/maintenance.js all` を実行していたが、`all` コマンドが未定義
     - 結果、週3回のメンテナンスチェックが**一度も実行されていなかった**
     - 自動修正も一度も行われず、ルール違反の記事が蓄積
     - ワークフローは成功していたが、実際にはヘルプメッセージが表示されるだけだった
   - **追加機能**: `all` コマンドを新規作成
     - `generateReport()` + `autoFixMetadata()` を順次実行
     - 問題検出 → 自動修正可能なものはすべて修正
     - Slug、カテゴリ、Excerpt、Meta Description を白崎セラ口調で再生成
     - プレースホルダーリンク変換、壊れたリンク削除など5つの修復タスク実行
   - **ワークフロー修正**:
     - `SANITY_API_TOKEN` → `SANITY_WRITE_TOKEN` に変更（autofix は書き込み権限必要）
     - ステップ名を「総合メンテナンス開始（検出＋自動修正）」に変更
   - **検出された主な問題**（初回レポート）:
     - 画像なし: 144件（ほぼ全記事）
     - 内部リンク多すぎ: 110件（3個超過）
     - 内部リンクとアフィリエイト近接: 84件
     - 無関係なリンク: 9件（面接記事に退職代行リンクなど）
   - **結果**: 次回の自動実行（月曜AM3:00）から、記事品質が自動改善されるように修正

15. 🗂️ **不適切な「テクノロジー」カテゴリ問題を修正** (2025-10-26)
   - **発覚した問題**:
     - 「テクノロジー」カテゴリ（技術・AI・ウェブ開発）が看護助手ブログに存在
     - 3件の記事（精神的負担、ブランド構築、転職方法）に誤って割り当てられていた
     - 記事生成時にカテゴリが指定されず、後で不適切なカテゴリが自動選択されていた
   - **修正内容**:
     - 3つの記事を適切なカテゴリに再割り当て
       - 精神的負担の記事 → 「悩み・相談」
       - ブランド構築の記事 → 「キャリア・資格」
       - 転職方法の記事 → 「就職・転職活動」
     - 「テクノロジー」カテゴリを完全削除（総カテゴリ数: 17→16種類）
     - 記事生成スクリプトを修正: Gemini AIに16種のカテゴリから最適なものを選ばせる
     - カテゴリ名をIDに変換してSanityに保存する処理を追加
   - **追加スクリプト**:
     - `scripts/check-categories.js`: 全記事のカテゴリ分布確認
     - `scripts/fix-tech-category.js`: テクノロジー記事の修正用
   - **テスト結果**: Gemini AIが「患者対応」カテゴリを正しく選択し、記事生成成功
   - **結果**: 今後の自動生成記事は、常に適切な看護助手関連カテゴリに割り当てられる

16. 📊 **カテゴリ統合とテール戦略の自動バランス調整機能実装** (2025-10-27)
   - **カテゴリ統合（16→14種類）**:
     - 重複カテゴリを統合し、すべて一言に簡素化
       - 「就職・転職活動」+「退職・転職サポート」→「転職」
       - 「キャリア・資格」+「資格取得」→「キャリア」
     - 97件の記事を最適なカテゴリに再配置（全145件中）
   - **カテゴリバランス自動調整**:
     - 記事数が少ない下位5カテゴリからランダム選択し優先生成
     - Gemini AIに優先カテゴリを明示的に指定
     - 週3回の自動生成で偏りを自動解消
   - **テール戦略の自動バランス調整**:
     - キーワード戦略（ショート1:ミドル3:ロング5）を実装
     - テール分類基準: ショート20-30文字、ミドル31-45文字、ロング46文字以上
     - 現在の分布を分析し、不足しているテールを優先生成
     - Gemini AIに文字数制約を厳守させる強化プロンプト
   - **メンテナンススクリプト拡張**:
     - `recategorize` コマンド追加: 全記事のカテゴリを再評価
     - `all` コマンドを拡張: report → recategorize → autofix の3ステップ実行
     - 週3回の自動メンテナンスでカテゴリとテールの両方を最適化
   - **追加スクリプト**:
     - `scripts/reorganize-categories.js`: カテゴリ統合・改名実行
     - `scripts/analyze-keyword-tail.js`: テール分布分析
   - **結果**: 包括的なコンテンツ戦略が自動的に実現し、ユーザーの悩みを網羅的に解決

17. 🧹 **記事冒頭の不要な挨拶文を自動削除する機能を追加** (2025-10-27)
   - **追加機能**: `scripts/utils/postHelpers.js` に `removeGreetings()` 関数を追加
     - 記事冒頭の「こんにちは」「はじめまして」などの挨拶文を検出・削除
     - 「ProReNataブログ編集長の白崎セラです」などの自己紹介文を削除
     - 「病棟で看護助手として働き始めて」などの背景説明を削除
     - 8つの正規表現パターンで包括的に検出
   - **削除対象パターン**:
     - 挨拶表現: 「こんにちは」「はじめまして」
     - 自己紹介: 「白崎セラです」「ProReNataブログ編集長の白崎セラです」
     - ウェルカム: 「ProReNataブログへようこそ」
     - 背景説明: 「病棟で看護助手として働き始めて」「もうすぐ〇年になります」
     - 応援文: 「皆さんの毎日の『お疲れさま』を応援しています」
   - **統合**: `scripts/maintenance.js` の `autoFixMetadata()` 関数に統合
     - 記事本文を自動的にクリーニング
     - 挨拶文が削除された場合はログに「記事冒頭の挨拶文を削除しました」と表示
     - 週3回の自動メンテナンス（月・水・金 AM3:00）で継続的に適用
   - **テスト結果**: 8件の記事で挨拶文削除を確認、すべて正常に動作
   - **効果**:
     - 記事の本題にすぐ入れるようになり、読みやすさが向上
     - SEO最適化にも寄与（導入文が記事の内容を直接説明）
     - 新規記事・既存記事ともに自動的にクリーニング

18. 🐛 **挨拶文削除機能のnullセーフティエラーを修正** (2025-10-27)
   - **問題**: GitHub Actionsでメンテナンススクリプトが "Cannot read properties of undefined (reading 'length')" エラーで失敗
   - **原因特定**:
     - `postHelpers.js` の `blocksToPlainText()` で `block.children` が配列かチェックしていなかった
     - `maintenance.js` の `categoriesForMeta` で全カテゴリ変数が undefined の場合に空配列フォールバックがなかった
     - `maintenance.js` で削除済みの `tooManyASPLinks` プロパティにアクセスしていた
   - **修正内容**:
     - `scripts/utils/postHelpers.js` (line 101): `Array.isArray(block.children)` チェック追加
     - `scripts/maintenance.js` (line 541): `|| []` フォールバック追加
     - `scripts/maintenance.js` (line 1638): `tooManyASPLinks` の存在チェック追加
     - `scripts/maintenance.js` (line 1736-1737): スタックトレース出力追加（デバッグ改善）
   - **テスト結果**:
     - ローカルテストで正常動作確認
     - 9件のDraft記事のPublishが成功
     - Exit code 0 で完全成功
   - **効果**: GitHub Actionsの週次メンテナンス（月・水・金 AM3:00）が正常に動作するように修正

19. 🐛 **GitHub Actions メンテナンスワークフローの権限エラー修正** (2025-10-27)
   - **問題**: GitHub Actionsで2つのエラーが発生
     - `Insufficient permissions; permission "update" required` (Sanity API)
     - `Resource not accessible by integration` (GitHub Issues)
   - **原因特定**:
     - ワークフローに `permissions` セクションがなく `issues: write` 権限が不足
     - `maintenance.js` は `SANITY_API_TOKEN` を使用するが、ワークフローは `SANITY_WRITE_TOKEN` のみ設定
     - 環境変数がインライン設定でスクリプトに正しく渡されていなかった
   - **修正内容**:
     - `.github/workflows/daily-maintenance.yml` に `permissions` セクション追加
       - `contents: read` と `issues: write` を明示的に設定
     - 環境変数を `env:` ブロックで設定
       - `SANITY_API_TOKEN` と `SANITY_WRITE_TOKEN` の両方を設定
     - インライン環境変数設定から `env:` ブロックに変更
   - **効果**:
     - GitHub Issue自動作成機能が正常に動作
     - Sanity API への書き込み権限が正しく設定される
     - 週次メンテナンス（月・水・金 AM3:00）が正常実行可能に

20. 💰 **Gemini APIコスト削減（▼18%削減）** (2025-10-28)
   - **コスト削減効果**: 約640トークン/記事削減、月間7,680トークン削減
   - **プロンプト簡素化**:
     - 白崎セラの人物像：400トークン → 150トークン（▼250トークン）
     - カテゴリ選択指示：削除（▼210トークン）
     - Excerpt生成指示：削除（▼130トークン）
     - Tags生成指示：基本タグのみ（▼50トークン）
   - **メタデータ生成をメンテナンスに移行**:
     - `generateTags()` 関数追加：タイトル・本文から関連タグを自動生成
     - Tags補完機能：2つ以下の場合、最大5つまで自動補完
     - Category、Excerpt、Meta Descriptionは既存機能で対応
   - **品質保証**:
     - タイトル生成（SEO戦略）維持
     - 本文生成（白崎セラ口調、1500-2200文字）維持
     - 構成（導入、H2見出し、まとめ）維持
     - ユーザビリティ、セラの執筆感、収益部分すべて担保
   - **フロントエンド修正**:
     - `PortableTextComponents.tsx`: リンクマーク無効化を解除
     - アフィリエイトリンクが正しくレンダリング（PR表示、外部リンク表示）
   - **アフィリエイトリンク改善**:
     - `separateAffiliateLinks()` 関数追加：リンクを独立した段落として分離
     - `removeClosingRemarks()` 関数追加：「次回のブログも〜」などの締めくくり文を削除
     - 「次のステップ」セクションへの誘導を妨げる文章を自動削除
   - **テスト結果**:
     - 記事生成：正常に動作（簡素化されたプロンプト）
     - メンテナンス：カテゴリ・Excerpt・Tags自動補完成功
   - **効果**: 次回の記事生成（月・水・金 AM2:00）からコスト削減、品質維持

21. 🚨 **緊急修正：Gemini Proモデルへのフォールバック防止（▼90-95%削減）** (2025-10-28)
   - **重大問題の発見**:
     - Google Cloud課金が月間予算¥1,000の50%（¥545）に到達
     - 全費用の100%がGemini API使用料と判明
     - 実際の課金：Gemini 2.5 **Pro** モデル使用（想定の10倍以上）
   - **根本原因**:
     - 全スクリプトで存在しない「gemini-2.5-flash」モデルを指定
     - 結果、自動的にGemini 2.5 Proにフォールバック
     - Pro料金：$5.00/1M output tokens（Flashの約17倍）
   - **緊急対応**:
     - 記事自動生成・メンテナンスワークフローを即座に停止
     - 4つのスクリプト全てを修正：
       - `scripts/run-daily-generation.cjs`
       - `scripts/expand-short-posts.js`
       - `scripts/clean-affiliate-sections.js`
       - `scripts/auto-post-to-x.js`
     - モデル名を「gemini-1.5-flash-latest」に統一
   - **コスト削減効果**:
     - 修正前：¥545/月（20記事、Proモデル）
     - 修正後：¥30-50/月（同条件、Flashモデル）→ **約90-95%削減**
     - 週1回実行時：¥6-10/月
   - **最終設定（週1回実行）**:
     - 記事自動生成：週1回（月曜AM2:00）→ ¥6-10/月
     - メンテナンス：週1回（月曜AM3:00）→ 無料
     - X自動投稿：毎日 → ¥15-45/月
     - **月間コスト総額：¥21-55**（予算¥300の7-18%）
   - **Google Cloud予算アラート**: ¥300/月に設定済み

## ⚠️ 重要なルール

**🚫 UIデザイン変更の完全禁止**
- レイアウト、色、フォント、スタイルの変更は絶対禁止
- 詳細は `UI-DESIGN-LOCK.md` を参照
- 違反した場合は最重要事項の不遵守となる

**🚫 SEOフィールド設定の変更禁止**
- excerpt, metaDescription, tagsのみ使用（確定）
- metaTitle, focusKeyword, relatedKeywordsは削除済み（再追加禁止）
- 詳細は `SEO-FIELDS-LOCK.md` を参照
- ユーザーの明示的指示なしに変更した場合は最重要違反となる

**🚨 Google Analytics & Search Console コード改変の完全禁止**
- Google Analytics トラッキングコードの変更は絶対禁止
- Google Search Console 確認コードの変更は絶対禁止
- 測定ID: G-HV2JLW3DPB の変更・削除は厳禁
- DNS TXT確認レコードの削除・変更は厳禁
- 違反した場合は最重要事項の不遵守となる

**🚨 Sanity Studio プレビューボタン機能の完全保護**
- `src/sanity/actions/PreviewAction.tsx` ファイルの削除は絶対禁止
- `sanity.config.ts` の PreviewAction 設定の削除・変更は絶対禁止
- プレビューボタン機能は業務の根幹システムであり削除は重大インシデント
- 設定ファイル:
  - Import: `import { PreviewAction } from './src/sanity/actions/PreviewAction'`
  - Actions設定: `actions: (prev, context) => { if (context.schemaType === 'post') { return [...prev, PreviewAction] } return prev }`
- 違反した場合は最重要事項の不遵守となる

**🚨 Gemini API Pro モデル使用の完全禁止**
- **絶対に Gemini Pro モデルを使用してはいけません**（最重要ルール）
- 使用可能なモデル: `gemini-1.5-flash-latest` **のみ**
- 使用禁止モデル: `gemini-2.5-pro`, `gemini-1.5-pro`, その他すべてのProモデル
- 理由: Proモデルは料金が約17-67倍高額（¥545/月 vs ¥30-50/月）
- 新しいスクリプトを作成する際は必ず `gemini-1.5-flash-latest` を使用すること
- 存在しないモデル名（例: `gemini-2.5-flash`）を指定すると自動的にProにフォールバックするため注意
- 違反した場合は重大な課金が発生するため最重要違反となる
