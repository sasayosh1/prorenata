# ProReNata プロジェクト完全知識ベース

このドキュメントは、ProReNataプロジェクトの全ルール、構造、ガイドライン、テンプレートを包括的にまとめたものです。
他のAI環境（Codex CLI、Gemini CLI等）でこのプロジェクトを扱う際は、このドキュメントを参照してください。

**最終更新日**: 2025-10-10

---

## 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [技術スタック](#技術スタック)
3. [重要なルール（絶対遵守）](#重要なルール絶対遵守)
4. [プロジェクト構造](#プロジェクト構造)
5. [自動メンテナンス](#自動メンテナンス)
6. [記事作成ガイドライン](#記事作成ガイドライン)
7. [アフィリエイトリンク管理](#アフィリエイトリンク管理)
8. [開発コマンド](#開発コマンド)
9. [デプロイメント](#デプロイメント)
10. [SEO設定](#seo設定)
11. [トラブルシューティング](#トラブルシューティング)

---

## プロジェクト概要

### 基本情報
- **プロジェクト名**: ProReNata（プロレナータ）
- **サイトURL**: https://prorenata.jp
- **目的**: 看護助手向け情報サイト
- **ターゲット**: 看護助手、介護職、医療従事者
- **記事数**: 139件（2025-10-10時点）
- **収益化率**: 89.7%

### コンセプト
- **最小限のデザイン**: Tailwind Next.js Starter Blogスタイル
- **シンプルで読みやすい**: 情報を探しやすい構造
- **SEO最適化**: 構造化データ、内部リンク最適化
- **アフィリエイト収益化**: 控えめで自然な配置

---

## 技術スタック

### フロントエンド
- **Framework**: Next.js 15.5.3/15.5.4
- **React**: 19.x
- **TypeScript**: 5.x
- **Styling**: Tailwind CSS 3.x
- **App Router**: Server Components使用

### CMS
- **Sanity CMS**
  - Project ID: `72m8vhy2`
  - Dataset: `production`
  - API Version: `2024-01-01`
  - Studio Port: 3333

### データ形式
- **Portable Text**: Sanityのブロックコンテンツ形式
- **JSON-LD**: 構造化データ（Article, BreadcrumbList, Organization）

### デプロイ
- **Hosting**: Vercel
- **Domain**: prorenata.jp
- **Analytics**: Google Analytics (G-HV2JLW3DPB)
- **Search Console**: DNS TXT認証済み

---

## 重要なルール（絶対遵守）

### 🚫 UI/UXデザインの変更禁止

**詳細**: `UI-DESIGN-LOCK.md` 参照

- レイアウト、色、フォント、スタイルの変更は**絶対禁止**
- Tailwind Next.js Starter Blogデザインを完全維持
- カスタムCSSの追加禁止
- デザイン変更はユーザーの明示的指示があっても慎重に確認

### 🚫 SEOフィールド設定の変更禁止

**詳細**: `SEO-FIELDS-LOCK.md` 参照

- 使用フィールド: `excerpt`, `metaDescription`, `tags` のみ
- 削除済みフィールド: `metaTitle`, `focusKeyword`, `relatedKeywords`
- 削除済みフィールドの再追加は**絶対禁止**

### 🚫 Google Analytics/Search Consoleコードの変更禁止

- トラッキングID: `G-HV2JLW3DPB`
- DNS TXT確認コード: `google-site-verification=Xy7fDHrYsVObXVQeb0D3He2wEWQCSnlsClAJ_OYsioE`
- コードの変更・削除は**絶対禁止**

### 🚫 Sanity Studio プレビューボタン機能の保護

**重要**: 削除は重大インシデント

- ファイル: `src/sanity/actions/PreviewAction.tsx`
- 設定: `sanity.config.ts` の PreviewAction 設定
- 削除・変更は**絶対禁止**

### ✅ Git コミットルール

- `--no-verify` や `--no-gpg-sign` は使用禁止（ユーザー明示的指示がある場合を除く）
- force pushは禁止（特にmain/master）
- コミットメッセージ末尾に必ず追加:
  ```
  🤖 Generated with [Claude Code](https://claude.com/claude-code)

  Co-Authored-By: Claude <noreply@anthropic.com>
  ```

---

## プロジェクト構造

```
prorenata/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── page.tsx           # トップページ
│   │   ├── about/             # Aboutページ
│   │   ├── blog/              # ブログ一覧
│   │   ├── posts/[slug]/      # 記事詳細ページ
│   │   ├── categories/        # カテゴリページ
│   │   └── api/               # API Routes
│   ├── components/            # Reactコンポーネント
│   │   ├── StructuredData.tsx # JSON-LD構造化データ
│   │   └── ...
│   ├── sanity/                # Sanity設定
│   │   ├── schema.ts          # スキーマ定義
│   │   ├── actions/           # カスタムアクション
│   │   └── ...
│   └── lib/                   # ユーティリティ
├── scripts/                   # 管理スクリプト
│   ├── moshimo-affiliate-links.js          # アフィリエイトリンクDB
│   ├── add-moshimo-links.js                # Moshimoリンク配置
│   ├── add-taishokudaikou-links.js         # 退職代行リンク配置
│   ├── insert-contextual-links.js          # 内部リンク挿入
│   ├── remove-internal-links.js            # 内部リンク削除
│   ├── fix-amazon-rakuten-links.js         # Amazon/楽天リンク修正
│   ├── remove-duplicate-posts.js           # 重複記事削除
│   ├── optimize-a8-kaigobatake-links.js    # A8.netリンク最適化
│   ├── reorganize-affiliate-links-matome.js # まとめセクション整理
│   ├── fix-h2-after-matome.js              # 見出し階層修正
│   ├── optimize-h3-sections.js             # H3セクション最適化
│   ├── verify-affiliate-links-live.js      # アフィリエイトリンク検証
│   ├── complete-affiliate-stats.js         # 統計レポート
│   ├── check-affiliate-links-health.js     # リンクヘルスチェック
│   ├── validate-links.js                   # リンク検証（週次）
│   ├── fix-all-link-issues.js              # 全リンク問題一括修正
│   ├── fix-affiliate-link-text.js          # アフィリエイトリンクテキスト修正
│   ├── remove-broken-internal-links.js     # 壊れたリンク削除
│   └── weekly-maintenance.sh               # 週次メンテナンス統合スクリプト
├── internal-links-analysis/   # 分析レポート
├── CLAUDE.md                  # Claude Code設定
├── UI-DESIGN-LOCK.md          # UIデザイン禁止ルール
├── SEO-FIELDS-LOCK.md         # SEOフィールド禁止ルール
├── ARTICLE_GUIDE.md           # 記事作成ガイド
└── PROJECT_KNOWLEDGE_BASE.md  # このファイル
```

### 重要ファイル

#### `CLAUDE.md`
- プロジェクト設定とコマンド
- 開発サーバー、ビルド、デプロイコマンド
- 最近の変更履歴

#### `UI-DESIGN-LOCK.md`
- UIデザイン変更の完全禁止ルール
- 許可されている変更の範囲

#### `SEO-FIELDS-LOCK.md`
- SEOフィールド設定の固定ルール
- 使用可能なフィールドのリスト

#### `ARTICLE_GUIDE.md`
- Sanity CMSでの記事作成手順
- 公開前チェックリスト
- 品質基準・執筆ルール

---

## 自動メンテナンス

### 週次メンテナンス（毎週月曜日 午前2時）

**実行スクリプト**: `scripts/weekly-maintenance.sh`

#### メンテナンス内容

1. **リンク検証**
   - 全記事のスラッグ確認（140件）
   - 関連記事リンク検証
   - 内部リンク検証（約580件）
   - アフィリエイトリンク検証

2. **問題検出時の自動修正**
   - スラッグ未設定 → SEO最適化スラッグを自動生成
   - 壊れた内部リンク → 正しいスラッグに自動修正または削除
   - アフィリエイトリンクテキスト未設定 → 自動追加（「かいご畑 [PR]」等）
   - 404エラー → 自動解消

3. **最終検証**
   - 修正後の全リンク再検証
   - エラーゼロを確認
   - ログ記録（`/logs/weekly-maintenance-YYYYMMDD-HHMMSS.log`）

#### 使用スクリプト

- `validate-links.js`: リンク検証
- `fix-all-link-issues.js`: 全リンク問題一括修正
- `fix-affiliate-link-text.js`: アフィリエイトリンクテキスト修正
- `remove-broken-internal-links.js`: 壊れたリンク削除

#### 実行確認

```bash
# 手動実行（テスト用）
./scripts/weekly-maintenance.sh

# ログ確認
ls -l logs/weekly-maintenance-*.log | tail -5
cat logs/weekly-maintenance-latest.log
```

#### Cron設定

```bash
# cron一覧確認
crontab -l

# 設定内容
0 2 * * 1 /Users/user/prorenata/scripts/weekly-maintenance.sh
```

---

## 記事作成ガイドライン

(省略...)

---

## アフィリエイトリンク管理

(省略...)

---


---
# (Appendix 1) ARTICLE_GUIDE.md
---

# ProReNata 記事作成ガイド

このガイドは、ProReNata（看護助手向け情報サイト）で記事を作成する際の標準手順と品質基準を定めたドキュメントです。

---

## 📍 記事テンプレート

詳細な記事構成テンプレートは以下を参照してください：

**テンプレートファイル**: `/Users/user/Documents/sasakiyoshimasa_article_template_codex.md`

このテンプレートには以下が含まれています：
- 記事構成の基本フォーマット
- 見出し構成のパターン
- 本文の書き方ルール
- SEO最適化のガイドライン
- 記事タイプ別テンプレート（4種類）
- チェックリスト

---

## 🎯 記事作成の基本方針

### 1. 読者ファースト

**ターゲット読者**：
- 看護助手として働いている方
- 看護助手を目指している方
- キャリアアップを考えている方

**記事で提供する価値**：
- 現場で即実践できる具体的なノウハウ
- キャリア形成に役立つ情報
- 給与・待遇などの実態データ
- 悩み・課題の解決策

### 2. 品質基準

**必須要件**：
- ✅ 文字数: 1500〜2500文字
- ✅ 見出し: H2を3〜5個使用
- ✅ 具体性: 数字・事例を含む
- ✅ 読みやすさ: 段落・箇条書きで構造化
- ✅ SEO: タイトル30〜40文字、ディスクリプション120〜160文字

**推奨事項**：
- 現場経験に基づいた体験談
- 最新の統計データ・調査結果
- 実践的なチェックリスト
- よくある質問と回答

### 3. 執筆ルール

**表現スタイル**：
- 親しみやすく、専門的すぎない
- 「です・ます」調で統一
- 読者に寄り添う共感的な表現

**避けるべき表現**：
- 医療行為の指示（法律違反）
- 断定的な表現（「絶対」「必ず」）
- 特定施設の批判
- 差別的・不適切な表現

---

## 📝 Sanity CMSでの記事作成手順

### ステップ1: Sanity Studioにアクセス

**ローカル環境**:
```bash
npx sanity dev --port 3007
```
→ http://localhost:3007 にアクセス

**本番環境**:
→ https://prorenata.sanity.studio にアクセス

### ステップ2: 新規記事作成

1. 左メニューから **「Post」** を選択
2. 右上の **「Create new document」** をクリック
3. 記事編集画面が表示される

### ステップ3: 必須項目の入力

#### Title（タイトル）
- **文字数**: 30〜40文字推奨

#### Slug（スラッグ）

**スラッグ生成ルール（厳守）**:

1. **形式**: `nursing-assistant-○○-○○` または `nursing-assistant-○○-○○-○○`
   - 必ず `nursing-assistant-` で開始
   - 続いて2〜3個のSEOキーワード（ハイフン区切り）
   - できれば2語、無理なら3語まで

2. **キーワード選定**:
   - 日本語タイトルから自動的に英語キーワードを抽出
   - SEO重視の核心ワードのみ（30+語のマッピング）
   - 例: 「夜勤」→ `night-shift`, 「給料」→ `salary`, 「辞めたい」→ `quit`

3. **生成例**:
   - `【シフトの悩み】看護助手の夜勤・交代制勤務を乗り切る5つのコツ` → `nursing-assistant-shift-night-shift-concern`
   - `看護助手の給料が低い理由と年収アップの方法` → `nursing-assistant-salary-reason`
   - `看護助手を辞めたいと思った時の対処法` → `nursing-assistant-quit`

4. **重要事項**:
   - ✅ タイムスタンプは含めない（SEO最適化のため）
   - ✅ 英数字のみ（日本語文字は絶対禁止）
   - ✅ 一意性はSanityが自動で保証（重複時は `-1`, `-2` を追加）
   - ✅ Sanity Studioで「Generate」ボタンをクリックすると自動生成

5. **実装場所**:
   - Sanityスキーマ: `schemas/post.ts` の `slugify` 関数
   - メンテナンススクリプト: `scripts/fix-all-link-issues.js`
   - 日本語スラッグ修正: `scripts/fix-japanese-slugs.js`

**タイトルルール**:
- キーワードを自然に含める
- 読者の検索意図を反映
- 具体的で魅力的な表現
- **例**: 「看護助手の給料相場は？地域別・経験年数別の平均年収を徹底解説」

#### Body（本文）
- リッチテキストエディタで記事本文を入力
- 見出し（H2, H3）、箇条書き、太字などを活用
- 画像挿入も可能

**エディタの使い方**：
- **H2見出し**: テキスト選択 → スタイル → Heading 2
- **H3見出し**: テキスト選択 → スタイル → Heading 3
- **箇条書き**: 箇条書きアイコンをクリック
- **太字**: テキスト選択 → 太字アイコン
- **画像**: 画像アイコン → ファイルアップロード

#### Categories（カテゴリ）
以下から適切なカテゴリを選択（複数選択可）：
- 転職・キャリア
- 資格・スキル
- 現場ノウハウ
- 給与・待遇
- 業務内容
- その他

#### Published at（公開日時）
- 公開予定日時を設定
- 即時公開の場合は現在日時

#### Author（著者）
- **「ProReNata編集部」を選択**（全記事統一）

### ステップ4: 任意項目の入力

#### Main Image（メイン画像）
- 記事のサムネイル画像
- 推奨サイズ: 1200×630px
- 形式: JPG, PNG

#### Excerpt（記事の要約）
- 記事の簡潔な要約（100〜150文字）
- 未入力の場合は自動生成される

#### Meta Title（SEOタイトル）
- 検索結果に表示されるタイトル
- 未入力の場合はTitleが使用される

#### Meta Description（SEO説明文）
- 検索結果に表示される説明文
- 120〜160文字推奨
- 記事の魅力を簡潔に伝える

### ステップ5: プレビュー・公開

1. **プレビュー**: 右上の「Preview」ボタンで表示確認
2. **保存**: 「Save」で下書き保存
3. **公開**: 「Publish」で記事を公開

---

## ✅ 公開前チェックリスト

記事を公開する前に、以下の項目を必ず確認してください：

### 内容の質
- [ ] 読者の悩み・課題に答えている
- [ ] 具体例やデータが含まれている
- [ ] 専門用語の説明がある
- [ ] 誤字脱字がない
- [ ] 事実関係に誤りがない

### 構成・読みやすさ
- [ ] 見出し構成が論理的
- [ ] 段落が適切に区切られている
- [ ] 箇条書きを効果的に使用している
- [ ] 文字数が1500〜2500文字

### SEO対策
- [ ] タイトルが30〜40文字
- [ ] ディスクリプションが120〜160文字
- [ ] フォーカスキーワードが含まれている
- [ ] 関連キーワードが自然に配置されている

### Sanity CMS設定
- [ ] カテゴリが正しく選択されている
- [ ] Authorが「ProReNata編集部」
- [ ] 公開日時が設定されている
- [ ] スラッグが適切

### プレビュー確認
- [ ] スマホ表示で読みやすい
- [ ] 画像が正しく表示される
- [ ] リンクが正常に機能する
- [ ] 関連記事が適切に表示される

---

## 🔄 記事更新・修正の手順

### 既存記事の編集

1. Sanity Studioで記事を検索
2. 該当記事をクリック
3. 必要箇所を編集
4. 「Save」で保存
5. 「Publish」で更新を公開

### 更新時の注意事項

- スラッグは変更しない（SEO影響大）
- 大幅な変更時は公開日時を更新
- 更新履歴をコメントに記録（任意）

---

## 📊 記事タイプ別の執筆ポイント

### タイプA: 基礎知識・解説系

**特徴**：
- 看護助手の基本的な知識を解説
- 初心者向けにわかりやすく

**構成のコツ**：
1. 「○○とは？」で定義を明確に
2. 重要性・メリットを説明
3. 具体的な内容を詳述
4. よくある質問に回答

**記事例**：
- 看護助手とは？仕事内容と資格要件
- 看護助手に必要なスキル10選

---

### タイプB: 実践ノウハウ系

**特徴**：
- 現場で即実践できる具体的な方法
- 経験者の知見を活かす

**構成のコツ**：
1. 悩みに共感し課題を提起
2. 解決のステップを明示
3. 現場のコツを具体的に
4. 失敗パターンを紹介
5. 体験談で説得力を高める

**記事例**：
- 患者さんとのコミュニケーション術
- 夜勤を乗り切る5つの方法

---

### タイプC: キャリア・転職系

**特徴**：
- キャリア形成の選択肢を提示
- 判断材料となる情報を提供

**構成のコツ**：
1. 現状の課題を提起
2. 選択肢と判断基準を示す
3. メリット・デメリットを比較
4. チェックリストで判断支援
5. 成功事例で具体的イメージ

**記事例**：
- 看護助手から看護師になる方法
- 働きやすい職場の見つけ方

---

### タイプD: データ・統計系

**特徴**：
- 最新データで実態を明らかに
- 数字で説得力を持たせる

**構成のコツ**：
1. 知りたい情報を明確に提示
2. データをグラフ・表で視覚化
3. 地域別・条件別に比較
4. データから読み取れるポイント
5. 今後の見通しを示す

**記事例**：
- 看護助手の給料相場2025年版
- 求人動向から見る転職市場

---

## 🚀 記事品質向上のTips

### 具体性を高める

**Before**: 多くの看護助手が悩んでいます
**After**: 調査によると、約7割の看護助手が人間関係に悩んでいます

### 読者目線で書く

**Before**: 医療従事者は感染対策を徹底すべきである
**After**: 患者さんとご自身を守るため、手洗いなどの感染対策を心がけましょう

### 行動を促す

**Before**: 転職を検討してみてください
**After**: まずは求人サイトに登録し、条件を比較することから始めましょう

---

## 📌 参考リソース

### 記事作成に役立つツール

- **文字数カウント**: https://moji-count.com/
- **見出し抽出**: ブラウザの開発者ツール
- **SEOチェック**: Google Search Console

### 参考サイト

- 厚生労働省: 医療従事者データ
- 日本看護協会: 看護業界動向
- 求人サイト: 給与相場データ

---

## 🔄 更新履歴

- **2025-10-08**: 初版作成 - ProReNata記事作成ガイド策定

---

**このガイドに従って、読者に価値ある記事を提供しましょう！**

---
# (Appendix 2) Article Template
---

# 記事作成テンプレート（ProReNata）

これは、ProReNataプロジェクトの記事を作成する際の標準テンプレートです。
このテンプレートに従って、一貫性のある高品質な記事を作成してください。

---

## 記事タイトル

```
【キーワード】読者の悩みに答える具体的なタイトル（30〜40文字）
```

**例**:
- 【給料】看護助手の平均年収は？手取り額と昇給の現実を解説
- 【辞めたい】看護助手を円満に辞める方法｜退職理由の伝え方と注意点

---

## 導入文

```
<!-- 2〜3段落、200〜300文字程度 -->
<!-- 読者の悩みに共感し、この記事を読むことで何が得られるかを明確に伝える -->
```

**例**:
「看護助手の仕事はやりがいがあるけれど、給料が低い…」と感じていませんか？日々の業務は忙しく、責任も重いのに、給与が見合っていないと感じると、モチベーションを維持するのは難しいですよね。

この記事では、看護助手の給料がなぜ低いのか、その理由を構造的な問題から解説します。さらに、給料を上げるための具体的な方法や、より良い条件で働くためのキャリアプランについても詳しくご紹介します。この記事を読めば、あなたの収入アップへの道筋が見えてくるはずです。

---

## H2: セクション1タイトル

```
<!-- 読者の疑問や関心に沿った見出し -->
<!-- 各H2セクションは2〜5段落で構成 -->
```

**例**:
## なぜ看護助手の給料は上がりにくいのか？

本文...（医療制度や業務範囲の観点から解説）

---

## H2: セクション2タイトル

**例**:
## 給料を上げるための具体的なアクション3選

本文...（資格取得、スキルアップ、転職などの方法を具体的に解説）

---

## H2: セクション3タイトル

**例**:
## 転職で年収アップを成功させるコツ

本文...（求人の選び方、面接対策、交渉術などを解説）

---

## H2: まとめ

```
<!-- 記事全体の要約、1〜2段落 -->
<!-- 読者の背中を押し、次の行動を促すメッセージ -->
```

**例**:
看護助手の給料は、制度的な要因から上がりにくいのが現実です。しかし、資格取得やスキルアップ、そして戦略的な転職によって、収入を増やすことは十分に可能です。

まずは、この記事で紹介した方法の中から、自分に合ったもの一つでも試してみてください。あなた自身の価値を高め、より良い条件で働くための一歩を踏み出しましょう。

---

### H3: より良い職場環境を探している方へ

```
<!-- まとめセクションの下に配置する任意セクション -->
<!-- アフィリエイトリンクへの自然な誘導 -->
```

**例**:
もし、現在の職場の給与や待遇に限界を感じているなら、転職エージェントに相談してみるのも一つの手です。あなたの経験やスキルを正当に評価してくれる職場が、きっと見つかります。

- **💼 介護・看護助手の求人なら「かいご畑」**
  - 未経験から有資格者まで、幅広い求人を掲載。キャリアアップをサポートします。
  - [公式サイトで求人を探す（無料）](#) [PR]

- **⚖️ 退職に関するお悩みなら**
  - スムーズな退職を弁護士がサポート。一人で悩まず、まずは無料相談から。
  - [退職代行サービスの公式サイトはこちら](#) [PR]

---

## ✅ 公開前チェックリスト

- [ ] タイトルは30〜40文字か？
- [ ] 導入文で読者の心を掴めているか？
- [ ] H2見出しは3〜5個か？
- [ ] 総文字数は1500文字以上か？
- [ ] 具体的な数字や事例は含まれているか？
- [ ] 誤字脱字はないか？
- [ ] Sanityのカテゴリ設定は正しいか？
- [ ] スマホでの表示は崩れていないか？

---
